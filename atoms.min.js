function mapLibrary(t,e,n){var i=t.indexOf(".");if(-1==i){var o=e[t];return o||(o=n,e[t]=o),o}var o=mapLibrary(t.substr(0,i),e,{});return mapLibrary(t.substr(i+1),o,n)}function createProperty(t,e){return e?function(){return this[t]}:function(e){this[t]=e}}function classCreator(t,e,n,i,o){var r=e?e.constructor:null,s=n||function(){},a=o,l=null;if(r){l=o?function(){for(var e in a)this["_"+e]=a[e];r.apply(this,arguments),this.__typeName=t,s.apply(this,arguments)}:function(){r.apply(this,arguments),this.__typeName=t,s.apply(this,arguments)};var m=r.prototype;for(var u in m)i[u]||m.hasOwnProperty(u)&&(i[u]=m[u])}else l=o?function(){this.__typeName=t;for(var e in a)this["_"+e]=a[e];s.apply(this,arguments)}:function(){this.__typeName=t,s.apply(this,arguments)};if(o)for(var u in o)i["get_"+u]||(i["get_"+u]=createProperty("_"+u,!0)),i["set_"+u]||(i["set_"+u]=createProperty("_"+u));return l.__typeName=t,r&&(l.__baseType=r),l.prototype=i,l.prototype.constructor=l,i.hasOwnProperty("toString")||(l.prototype.toString=function(){return t}),mapLibrary(/\./.test(t)?t:"WebAtoms."+t,window,l),l}function classCreatorEx(t){return classCreator(t.name,t.base,t.start,t.methods,t.properties)}var createClass=classCreatorEx,WebAtoms={};!function(window,WebAtoms){var $=window.$,document=window.document,Templates={jsonML:{}};window.Templates=Templates,Templates.jsonML["WebAtoms.AtomAutoCompleteBox.template"]=[["input",{"atom-presenter":"selectionBox",disabled:"disabled",type:"text","style-display":"[$owner.isPopupOpen ? '' : 'none']","atom-value":"[$owner.selectedText]"}],["input",{"atom-presenter":"inputBox","atom-placeholder":"[$owner.placeholder]",type:"text","atom-value":"$[owner.displayLabel](keyup)"}],["div",{"atom-presenter":"itemsPresenter","class":"atom-list-box",style:"position: absolute; z-index: 100;","style-left":"[($owner.offsetLeft + 2) + 'px']","style-top":"[($owner.offsetTop + 24) + 'px']","style-display":"[$owner.isPopupOpen ? 'block' : 'none']"},["div",{"atom-template":"itemTemplate",style:"min-width:100px;","atom-text":"{ $data[$owner.templateParent.labelPath] }"}]]],Templates.jsonML["WebAtoms.AtomCalendar.template"]=[["div",{},["div",{"class":"title"},["button",{"class":"atom-prev-button","atom-event-click":"{$owner.templateParent.prevMonthCommand}"},"Previous"],["span",{"atom-text":"[ AtomDate.monthList[$owner.templateParent.currentMonth-1].label + ' ' + $owner.templateParent.currentYear]"}],["button",{"class":"atom-next-button","atom-event-click":"{$owner.templateParent.nextMonthCommand}"},"Next"]],["div",{"class":"day-headers"},["span",{"class":"weekend"},"Sunday"],["span",{},"Monday"],["span",{},"Tuesday"],["span",{},"Wednesday"],["span",{},"Thursday"],["span",{},"Friday"],["span",{"class":"weekend"},"Saturday"]],["div",{"class":"days","atom-presenter":"itemsPresenter"}]]],Templates.jsonML["WebAtoms.AtomCheckBoxList.itemTemplate"]=[["div",{"atom-template":"itemTemplate"},["input",{type:"checkbox","atom-checked":"$[scope.itemSelected]"}],["span",{"atom-text":"{$data[$owner.templateParent.labelPath]}"}]]],Templates.jsonML["WebAtoms.AtomDataPager.template"]=[["button",{"class":"atom-pager-first-button","atom-is-enabled":"[$owner.pages.length > 1 && $owner.currentPage]","event-click":"{$owner.goFirstCommand}",style:"float:left"},"\nFirst\n"],["span",{style:"text-align:left"},["button",{"class":"atom-pager-prev-button","event-click":"{$owner.goPrevCommand}","atom-is-enabled":"[$owner.currentPage]"},"\nPrev\n"],["span",{},"Goto: Page"],["select",{"atom-type":"AtomComboBox","atom-items":"[$owner.atomParent.pages]","atom-value":"$[owner.atomParent.currentPage]"}],["button",{"class":"atom-pager-next-button","event-click":"{$owner.goNextCommand}","atom-is-enabled":"[$owner.currentPage < $owner.pages.length -1 ]"},"\nNext\n"]],["button",{"class":"atom-pager-last-button","event-click":"{$owner.goLastCommand}","atom-is-enabled":"[$owner.pages.length > 1 && $owner.currentPage < $owner.pages.length -1 ]",style:"float:right"},"\nLast\n"]],Templates.jsonML["WebAtoms.AtomDateField.popupTemplate"]=[["div",{"class":"atom-date-field-popup","style-left":"[($owner.offsetLeft ) + 'px']","style-top":"[($owner.offsetTop + 25) + 'px']"},["div",{"class":"atom-date-list-box","atom-class":"[$owner.isOpen ? 'popup-open' : 'popup-closed' ]"},["div",{"class":"calendar","atom-presenter":"calendarPresenter"},["select",{"atom-type":"AtomComboBox","class":"month","atom-items":"{AtomDate.monthList}","atom-value":"$[owner.templateParent.month]"}],["select",{"atom-type":"AtomNumberComboBox","class":"year","atom-start-number":"[ $owner.templateParent.currentYear + $owner.templateParent.startYear]","atom-end-number":"[ $owner.templateParent.currentYear + $owner.templateParent.endYear]","atom-value":"$[owner.templateParent.year]"}],["div",{"class":"days"},["span",{"class":"weekend-header"},"S"],["span",{},"M"],["span",{},"T"],["span",{},"W"],["span",{},"T"],["span",{},"F"],["span",{"class":"weekend-header"},"S"]],["div",{"class":"day-list","atom-type":"AtomItemsControl","atom-items":"[$owner.templateParent.items]","atom-presenter":"itemsPresenter"},["div",{"atom-event-click":"{ $owner.templateParent.templateParent.toggleDateCommand }","atom-class":"[ { 'list-item':true, 'weekend': $data.isWeekEnd, other: $data.isOtherMonth, today: $data.isToday, 'selected': Atom.query($owner.templateParent.templateParent.selectedItems).any({ value: $data.value}) } ]","atom-template":"itemTemplate"},["span",{"atom-text":"[$data.label]"}]]]]]]],Templates.jsonML["WebAtoms.AtomDateField.template"]=[["div",{"class":"date-label","atom-class":"[$owner.isOpen ? 'date-label-open' : 'date-label-closed']","atom-event-click":"[ { owner: { isOpen: ! $owner.isOpen } } ]","atom-text":"[ $owner.selectedItem ? $owner.selectedItem.dateLabel : 'SELECT' ]"}]],Templates.jsonML["WebAtoms.AtomDateListBox.template"]=[["div",{"class":"atom-date-list-box"},["div",{"class":"calendar"},["select",{"atom-type":"AtomComboBox","class":"month","atom-items":"{AtomDate.monthList}","atom-value":"$[owner.templateParent.month]"}],["select",{"atom-type":"AtomComboBox","class":"year","atom-items":"[ Atom.range( $owner.value + $owner.templateParent.startYear, $owner.value + $owner.templateParent.endYear) ]","atom-value":"$[owner.templateParent.year]"}],["div",{"class":"days"},["span",{"class":"weekend-header"},"S"],["span",{},"M"],["span",{},"T"],["span",{},"W"],["span",{},"T"],["span",{},"F"],["span",{"class":"weekend-header"},"S"]],["div",{"class":"day-list","atom-presenter":"itemsPresenter"},["div",{"event-click":"{ $owner.templateParent.toggleDateCommand }","atom-data":"[$owner.templateParent.items[$scope.itemIndex]]","atom-class":"[ { 'list-item':true, 'weekend': $data.isWeekEnd, other: $data.isOtherMonth, today: $data.isToday, 'selected': Atom.query($owner.templateParent.selectedItems).any({ value: $data.value}) } ]","atom-template":"itemTemplate"},["span",{"atom-text":"[$data.label]"}]]]],["div",{"class":"list","atom-type":"AtomListBox","atom-items":"[$owner.templateParent.selectedItems]","atom-label-path":"dateLabel","atom-value-path":"date","atom-value":"$[$owner.templateParent.visibleDate]"},["div",{"atom-template":"itemTemplate","atom-text":"{$data.dateLabel}"}]]]],Templates.jsonML["WebAtoms.AtomItemsControl.itemTemplate"]=[["span",{"atom-text":"[$data[$owner.atomParent.labelPath]]"},"Item"]],Templates.jsonML["WebAtoms.AtomLinkBar.itemTemplate"]=[["a",{"atom-href":"{$data[$owner.atomParent.valuePath]}","atom-target":"{$data[$owner.atomParent.targetPath]}","atom-class":"{$data[$owner.templateParent.itemsPath] ? (($data[$owner.templateParent.itemsPath]).length ? 'atom-link-bar-down-image' : '' ) : '' }"},["span",{"atom-text":"{$data[$owner.atomParent.labelPath]}"}]]],Templates.jsonML["WebAtoms.AtomLinkBar.menuTemplate"]=[["div",{"class":"menu","atom-type":"AtomLinkBar","atom-items":"[$data[$owner.templateParent.itemsPath]]","atom-menu-template":"{$owner.templateParent.menuTemplate}","atom-menu-direction":"vertical"},["div",{"atom-presenter":"itemsPresenter"},["div",{"atom-template":"itemTemplate"},["a",{"atom-href":"{$data[$owner.templateParent.valuePath]}","atom-text":"{$data[$owner.templateParent.labelPath]}","atom-target":"{$data.target}","atom-event-click":"{$data.action}"}]]]]],Templates.jsonML["WebAtoms.AtomNavigatorList.detailTemplate"]=[["iframe",{"class":"atom-navigator-list-iframe","atom-template":"detailTemplate","atom-src":"[$owner.templateParent.displayMode == 1 ?( $owner.templateParent.displayMode == 2 ? $owner.templateParent.newUrl : $owner.templateParent.detailUrl ): 'about:none']"}]],Templates.jsonML["WebAtoms.AtomNavigatorList.template"]=[["div",{"atom-type":"AtomViewStack","atom-selected-index":"[$owner.atomParent.displayMode]"},["div",{"atom-type":"AtomDockPanel","atom-presenter":"gridPanel"},["div",{"atom-dock":"Fill","atom-presenter":"gridPresenter","class":"atom-navigator-list-grid"}]],["div",{"atom-data":"[$owner.templateParent.selectedItem]","atom-presenter":"detailView","atom-type":"AtomDockPanel"},["div",{"atom-dock":"Top","atom-presenter":"detailHeaderToolbar"},["input",{type:"button","event-click":"[$owner.templateParent.backCommand]",value:"Back",style:"float: left"}]]],["div",{"atom-data":"[$owner.templateParent.newItemCopy]","atom-presenter":"newView","atom-type":"AtomDockPanel"},["div",{"atom-dock":"Top","atom-presenter":"newHeaderToolbar"},["input",{type:"button","event-click":"[$owner.templateParent.cancelAddCommand]",value:"Back",style:"float: left"}]]]]],Templates.jsonML["WebAtoms.AtomSortableColumn.template"]=[["span",{"atom-text":"[$owner.label]"}]],Templates.jsonML["WebAtoms.AtomTabControl.template"]=[["div",{"atom-type":"AtomDockPanel"},["span",{"atom-dock":"Top","atom-type":"AtomToggleButtonBar","atom-label-path":"[$owner.templateParent.labelPath]","atom-items":"[$owner.templateParent.items]","atom-selected-index":"$[owner.templateParent.selectedIndex]",style:"height: 30px; text-align:center; display:inline-block"},["span",{"atom-template":"itemTemplate","atom-text":"[$data]"}]],["div",{"atom-dock":"Fill","atom-type":"AtomViewStack","atom-selected-index":"[$owner.templateParent.selectedIndex]","atom-presenter":"itemsPresenter"}]]],Templates.jsonML["WebAtoms.AtomToggleButtonBar.template"]=[["span",{"class":"items-presenter","atom-presenter":"itemsPresenter"}]],Templates.jsonML["WebAtoms.AtomWizard.template"]=[["div",{"atom-dock":"Fill","atom-type":"AtomViewStack","atom-selected-index":"$[owner.templateParent.currentStep]","atom-presenter":"viewPresenter"}],["div",{"atom-dock":"Bottom","class":"atom-wizard-command-bar"},["button",{"class":"atom-wizard-back-button","atom-is-enabled":"[$owner.canMoveBack]","atom-event-click":"{$owner.goPrevCommand}","style-visibility":"[$owner.currentStep ? 'visible' : 'hidden']"},["span",{"atom-text":"[$owner.prevLabel]"}]],["button",{"class":"atom-wizard-next-button","atom-class":"[$owner.nextClass || ($owner.isLastStep ? 'finish-button' : '')]","atom-event-click":"{$owner.nextCommand}","atom-is-enabled":"[$owner.nextCommand]"},["span",{"atom-text":"[$owner.isLastStep ? $owner.finishLabel : $owner.nextLabel]"}]]]],Templates.jsonML["WebAtoms.AtomYesNoCustom.template"]=[["span",{"atom-type":"AtomYesNoControl","atom-presenter":"yesNo","atom-value":"$[owner.templateParent.hasValue]"}],["input",{style:"vertical-align:top",type:"text","atom-is-enabled":"[$owner.hasValue]","atom-presenter":"input","atom-placeholder":"[$owner.placeholder]"}]],Templates.jsonML["WebAtoms.AtomApplication.busyTemplate"]=[["div",{style:"position:absolute;left:0px;top:0px;z-index:10000; display:none","style-width":"[$owner.appWidth + 'px']","style-height":"[$owner.appHeight + 'px']","style-display":"[$owner.isBusy ? 'block' : 'none']"},["div",{"class":"atom-busy-window",style:"position:absolute","style-left":"[(($owner.appWidth/2)-100) + 'px']","style-top":"[(($owner.appHeight/2)-25) + 'px']"},["div",{"atom-abs-pos":"12,12,36,36","class":"atom-busy-image"}],["div",{"atom-abs-pos":"56,24,145,null","atom-text":"[$owner.busyMessage || 'Loading...']"}],["div",{"atom-abs-pos":"0,48",style:"height:3px; background-color:green","style-display":"[$owner.isBusy && $owner.progress ? 'block' : 'none']","style-width":"[$owner.progress + '%']"}]]]],Templates.jsonML["WebAtoms.AtomFormGridLayout.fieldTemplate"]=[["table",{"class":"atom-form-grid-row","atom-type":"AtomFormField","atom-class":"[$owner.fieldClass]","style-display":"[$owner.fieldVisible ? '' : 'none']"},["tbody",{},["tr",{},["td",{"class":"atom-form-grid-label","atom-text":"[$owner.label]","style-min-width":"[$owner.atomParent.minLabelWidth ? ($owner.atomParent.minLabelWidth + 'px') : undefined]"}],["td",{"class":"atom-form-grid-required","atom-class":"[$owner.required ? 'atom-form-grid-required' : 'atom-form-grid-not-required']"},"*"],["td",{"class":"atom-form-grid-content","atom-class":"[$owner.error ? 'atom-data-error' : '']","atom-presenter":"contentPresenter"}],["td",{"atom-class":"[$owner.error ? 'atom-data-error' : '']","atom-text":"[$owner.error || '']","style-display":"[$owner.error ? '' : 'none']"}]]]]],Templates.jsonML["WebAtoms.AtomFormLayout.fieldTemplate"]=[["tr",{"atom-type":"AtomFormField","atom-class":"[$owner.fieldClass]","style-display":"[$owner.fieldVisible ? '' : 'none']"},["td",{"class":"atom-form-label","atom-text":"[$owner.label]","style-min-width":"[$owner.atomParent.minLabelWidth || undefined]"}],["td",{"class":"atom-form-required","atom-text":"[$owner.required ? '*' : '']"}],["td",{"class":"atom-form-content","atom-class":"[$owner.error ? 'atom-data-error' : '']","atom-presenter":"contentPresenter"},["span",{"class":"atom-form-error","atom-text":"[$owner.error || '']"}]]]],Templates.jsonML["WebAtoms.AtomFormVerticalLayout.fieldTemplate"]=[["tr",{"atom-type":"AtomFormField"},["td",{},["div",{},["span",{"class":"atom-form-label","atom-text":"[$owner.label]"}],["span",{"class":"atom-form-required","atom-text":"[$owner.required ? '*' : '']"}]],["div",{"class":"atom-form-content","atom-class":"[$owner.error ? 'atom-data-error' : '']","atom-presenter":"contentPresenter"}],["div",{"class":"atom-form-error","atom-text":"[$owner.error || '']"}]]]],Templates.jsonML["WebAtoms.AtomWindow.alertTemplate"]=[["div",{"class":"atom-alert","atom-dock":"Fill"},["pre",{"atom-text":"{$data.Message}"}],["div",{"class":"buttons","atom-class":"{ $data.Confirm ? 'confirm-buttons' : 'alert-buttons' }"},["button",{"class":"ok","atom-event-click":"{$owner.templateParent.closeCommand}"},"Ok"],["button",{"class":"yes","atom-event-click":"{ [ { data: { ConfirmValue: true } } , $owner.templateParent.closeCommand ] }"},"Yes"],["button",{"class":"no","atom-event-click":"{$owner.templateParent.closeCommand}"},"No"]]]],Templates.jsonML["WebAtoms.AtomWindow.frameTemplate"]=[["div",{"class":"atom-window-background","style-width":"[$appScope.owner.bodyWidth + 'px']","style-height":"[$appScope.owner.appHeight + 'px']","style-display":"[$owner.isOpen ? 'block' : 'none']"},["div",{"class":"atom-window","atom-presenter":"windowDiv",style:"position:absolute","style-width":"[$owner.atomParent.windowWidth + 'px']","style-height":"[$owner.atomParent.windowHeight + 'px']","style-left":"[(($appScope.owner.bodyWidth-$owner.atomParent.windowWidth)/2) + 'px']","style-top":"[(($appScope.owner.bodyHeight-$owner.atomParent.windowHeight)/2) + 'px']","atom-type":"AtomDockPanel"},["div",{"class":"atom-window-title","atom-dock":"Top","atom-presenter":"windowTitleDiv","atom-text":"[$owner.atomParent.title]"}],["div",{"class":"atom-window-close-button","atom-presenter":"windowCloseButton","atom-event-click":"{$owner.atomParent.closeCommand}"}]]]],Templates.jsonML["WebAtoms.AtomWindow.windowTemplate"]=[["iframe",{"class":"atom-window-frame","atom-presenter":"iframe","atom-src":"{$owner.templateParent.url}"}]];var AtomConfig={debug:!1,baseUrl:"",log:"",ajax:{versionUrl:!0,versionKey:"__wav",version:(new Date).toDateString(),headers:{}}};window.AtomConfig=AtomConfig;var log=function(t){window.console&&console.log(t),AtomConfig.log+=t+"\r\n"};window.log=log;var AtomBrowser={browserName:"",version:"1.0",majorVersion:1,isMobile:!1,userAgent:"",detect:function(){var t=(navigator.appVersion,navigator.userAgent);this.userAgent=t;var e,n,i,o=navigator.appName,r=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10);-1!=(n=t.indexOf("Opera"))?(o="Opera",r=t.substring(n+6),-1!=(n=t.indexOf("Version"))&&(r=t.substring(n+8))):-1!=(n=t.indexOf("MSIE"))?(o="Microsoft Internet Explorer",r=t.substring(n+5)):-1!=(n=t.indexOf("Chrome"))?(o="Chrome",r=t.substring(n+7)):-1!=(n=t.indexOf("Safari"))?(o="Safari",this.isMobile=-1!=t.indexOf("iPhone"),r=t.substring(n+7),-1!=(n=t.indexOf("Version"))&&(r=t.substring(n+8))):-1!=(n=t.indexOf("Firefox"))?(o="Firefox",r=t.substring(n+8)):(e=t.lastIndexOf(" ")+1)<(n=t.lastIndexOf("/"))&&(o=t.substring(e,n),r=t.substring(n+1),o.toLowerCase()==o.toUpperCase()&&(o=navigator.appName)),-1!=(i=r.indexOf(";"))&&(r=r.substring(0,i)),-1!=(i=r.indexOf(" "))&&(r=r.substring(0,i)),s=parseInt(""+r,10),isNaN(s)&&(r=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10)),this.browserName=o,this.majorVersion=s,this.isMobile=/android|mobile|ios|iphone/gi.test(t)},isFF:!1,isChrome:!1,isIE:!1,isSafari:!1,isMac:!1,init:function(){switch(this.isMac=/mac os x/gi.test(this.userAgent)&&!/iphone|ipad/gi.test(this.userAgent),this.browserName){case"Firefox":this.supportsUpload=this.majorVersion>=4,this.isFF=!0;break;case"Chrome":this.supportsUpload=this.majorVersion>=6,this.isChrome=!0;break;case"Microsoft Internet Explorer":this.supportsUpload=this.majorVersion>=10,this.isIE=!0;break;case"Safari":this.isSafari=!0,this.isMobile||(this.supportsUpload=this.majorVersion>=5)}this.supportsFlash=!this.isMobile}};window.AtomBrowser=AtomBrowser,AtomBrowser.detect(),AtomBrowser.init();var AtomEnumerator=function(t,e){return classCreator(t,e,function(t){this._array=t,this.i=-1},{next:function(){return this.i=this.i+1,this.i<this._array.length},current:function(){return this._array[this.i]},currentIndex:function(){return this.i},isFirst:function(){return 0==this.i},isLast:function(){return this.i==this._array.length-1},reset:function(){this.i=-1}})}("AtomEnumerator",null);window.AtomEnumerator=AtomEnumerator;var Atom={refreshWindowCommand:function(){location.href=location.pathname+"?_v="+(new Date).getTime()+location.hash},time:function(){return(new Date).getTime()},get:function(t,e){var n=e.indexOf(".");if(-1!=n){var i=e.substr(0,n);return t=AtomBinder.getValue(t,i),e=e.substr(n+1),Atom.get(t,e)}return AtomBinder.getValue(t,e)},set:function(t,e,n){var i=e.indexOf(".");if(-1!=i){var o=e.substr(0,i);return t=AtomBinder.getValue(t,o),e=e.substr(i+1),Atom.set(t,e,n)}AtomBinder.setValue(t,e,n)},csv:function(t,e,n){n||(n=", ");for(var i=[],o=new AtomEnumerator(t);o.next();){var r=o.current();i.push(Atom.get(r,e))}return i.join(n)},range:function(t,e,n){var i=[];n=n||1;for(var o=t;e>=o;o+=n)i.push({label:o,value:o});return i},merge:function(t,e,n,i){if(t){var o=i?AtomBinder.getClone(e):e;if(n)for(var r in o)Atom.set(t,r,AtomBinder.getValue(o,r));else for(var r in o)t[r]=o[r];return t}},url:function(t,e,n){var i=t,o=[];if(e){for(var r in e)if(e.hasOwnProperty(r)){var s=e[r];if(void 0===s)continue;if(null===s)continue;s&&s.constructor!=String&&"object"==typeof s&&(s=JSON.stringify(s)),o.push(r+"="+encodeURIComponent(s))}if(o.length){var a=i.indexOf("?");i+=-1==a?"?":"&"}i+=o.join("&")}if(n){o=[];for(var r in n)if(n.hasOwnProperty(r)){var s=n[r];if(void 0===s||null===s)continue;o.push(r+"="+encodeURIComponent(s))}o.length&&(i+="#"+o.join("&"))}return i},encodeParameters:function(t){var e=[];for(var n in t)if(0!=n.indexOf("_")){var i=t[n];if(void 0!==i&&null!==i){var o=typeof i;("string"==o||"number"==o||"boolean"==o)&&e.push(n+"="+encodeURIComponent(i))}}return e.join("&")},tableLayout:function(t,e,n){return new WebAtoms.AtomTableLayout(t,e,n)},toDash:function(t){return t.replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})},secureUrl:function(){for(var t="",e=0;e<arguments.length;e++){var n=arguments[e];if(null===n||void 0===n)return void 0;t+=n}return/^\/\//.test(t)?document.location.protocol+t:("https:"==document.location.protocol&&(t=t.replace(/http\:\/\//,"https://")),t)}};Atom.resolve=function(t,e){var n=!e;if(!t)return t;n&&(e=new AtomPromise,e.list=[],e.done=function(n){Atom.remove(e.list,n),0==e.list.length&&e.pushValue(t)});var i=typeof t;if("object"==i)if("undefined"!=typeof t.length)for(var o=0;o<t.length;o++){var r=t[o];if(r){var s=t,a=o;r instanceof AtomPromise||r.constructor==AtomPromise?(e.list.push(r),r.failed(function(t){e.done(t)}),r.then(function(t){s[a]=t.value(),e.done(t)})):Atom.resolve(r,e)}}else for(var o in t){var r=t[o];if(r)if(r instanceof AtomPromise||r.constructor==AtomPromise){e.list.push(r),r.failed(function(t){e.done(t)});var s=t,a=o;r.then(function(t){s[a]=t.value(),e.done(t)})}else Atom.resolve(r,e)}return e.list.length?(n&&e.onInvoke(function(){for(var t=new AtomEnumerator(e.list);t.next();)t.current().invoke(e._invoker)}),e):t},window.Atom=Atom,function(){for(var t,e=/\+/g,n=/([^&=]+)=?([^&]*)/g,i=function(t){return decodeURIComponent(t.replace(e," "))},o=window.location.search.substring(1),r={};t=n.exec(o);)r[i(t[1])]=i(t[2]);Atom.pageQuery=r}();var AtomDate={zoneOffset:60*(new Date).getTimezoneOffset()*1e3,toLocalTime:function(t){return t.toJSON()},m_names:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],setTime:function(t,e){if(!t||!e)return t;var n=e.split(":"),i=parseInt(n[0]);n=n[1].split(" ");var o=parseInt(n[0]);"PM"==n[1]&&12!=i&&(i+=12);var r=new Date(t.getFullYear(),t.getMonth(),t.getDate());return r.setHours(i),r.setMinutes(o),r},toMMDDYY:function(t){var e=t.getMonth()+1,n=t.getFullYear(),i=t.getDate(),o="";return o+=e>9?e:"0"+e,o+="/"+(i>9?i:"0"+i),o+="/"+n},toShortDateString:function(t){if(!t)return"";if(t.constructor==String){if(!/^\/date\(/gi.test(t))throw new Error("Invalid date format "+t);t=t.substr(6),t=new Date(parseInt(t,10))}return this.m_names[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear()},toDateTimeString:function(t){if(!t)return"";t.constructor==String&&(t=t.substr(6),t=new Date(parseInt(t,10)));var e=AtomDate.toShortDateString(t);return e+" - "+AtomDate.toTimeString(t)},toTimeString:function(t){if(t=AtomDate.parse(t),!t)return"";var e=t.getHours(),n="AM";12==e?n="PM":e>12&&(e-=12,n="PM");var i=t.getMinutes();return 10>i?i="0"+i:(i+="",1==i.length&&(i+="0")),e+":"+i+" "+n},smartDate:function(t){if(!t)return null;var e=AtomDate.parse(t),n=new Date;if(n.getFullYear()===e.getFullYear()&&n.getMonth()===e.getMonth()){var i=n.getDate()-e.getDate();switch(i){case-1:return"Tomorrow ("+AtomDate.toTimeString(e)+")";case 0:return"Today ("+AtomDate.toTimeString(e)+")";case 1:return"Yesterday ("+AtomDate.toTimeString(e)+")"}}return AtomDate.toDateTimeString(e)},smartDateUTC:function(t){return AtomDate.smartDate(t)},parse:function(t){if(!t)return null;if(t.constructor!==String)return t;if(/^\/date\([\-0-9]+\)\//gi.test(t))t=new Date(parseInt(t.substr(6),10));else{if(/^\/dateiso/gi.test(t)){t=t.substr(9),t=t.substr(0,t.length-1);var e=t.split("T"),n=e[0],i=e[1];n=n.split("-"),i=i.split(":");var o=new Date(n[0],parseInt(n[1])-1,n[2],i[0],i[1],parseFloat(i[2]));return o=new Date(o.getTime()+AtomDate.zoneOffset)}t=Date.parse(t)}return t}};window.AtomDate=AtomDate,AtomDate.monthList=[{label:"January",value:1},{label:"February",value:2},{label:"March",value:3},{label:"April",value:4},{label:"May",value:5},{label:"June",value:6},{label:"July",value:7},{label:"August",value:8},{label:"September",value:9},{label:"October",value:10},{label:"November",value:11},{label:"December",value:12}];var AtomFileSize={toFileSize:function(t){return t?(t.constructor==String&&(t=parseInt(t,10)),t>1073741824?Math.round(t/1073741824)+" GB":t>1048576?Math.round(t/1048576)+" MB":t>1024?Math.round(t/1024)+" KB":t+" B"):""}};window.AtomFileSize=AtomFileSize;var AtomPhone={toSmallPhoneString:function(t){if(!t)return"";var e=t.split(":",6),n=e[2];n="("+(/^\+/.test(n)?"":"+")+e[2]+") ";{var i=e[3];e[4],e[5]}return i?n+i:""},toPhoneString:function(t){if(!t)return"";var e=t.split(":",6),n="(+"+e[2]+") ",i=e[3],o=e[4],r=e[5];if(!i)return"";var s=n+i;return o&&(s+=" (ext: "+o+")"),r&&(s+=" ("+r+")"),s}};window.AtomPhone=AtomPhone;var AtomEvaluator={ecache:{},becache:{},parse:function(t){var e=this.becache[t];if(e)return e;var n=/(?:(\$)(window|appScope|scope|data|owner|localScope))(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*/gi,i=[],o=[],r=t.replace(n,function(t){var e="v"+(i.length+1);return t=t.substr(0==t.indexOf("$owner.")?7:0==t.indexOf("owner.")?6:1),i.push(t.split(".")),o.push(e),e}),s="return "+r+";",a=s;try{s=AtomEvaluator.compile(o,s)}catch(l){throw Atom.alert("Error executing \n"+a+"\nOriginal: "+t),l}return e={length:o.length,method:s,path:i,original:r},this.becache[t]=e,e},compile:function(t,e){var n=t.join("-")+":"+e,i=this.ecache[n];return i?i:(t.push("Atom"),t.push("AtomPromise"),i=new Function(t,e),this.ecache[n]=i,i)}};window.AtomEvaluator=AtomEvaluator;var ChildEnumerator=null;AtomBrowser.isIE&&AtomBrowser.majorVersion<9?(ChildEnumerator=function(t){this.index=-1,this.nextItem=t.firstChild,this.findNext(),this.item=null},ChildEnumerator.prototype={findNext:function(){for(var t=this.nextItem;t&&1!==t.nodeType;)t=t.nextSibling;this.nextItem=t,this.index++},isFirst:function(){return 1===this.index},isLast:function(){return this.item&&!this.nextItem},next:function(){return this.item=this.nextItem,this.item?(this.nextItem=this.item.nextSibling,this.findNext(),this.item?!0:!1):!1},current:function(){return this.item}},window.ChildEnumerator=ChildEnumerator):(ChildEnumerator=function(t){this.nextItem=t.firstElementChild,this.item=null,this.first=!0},ChildEnumerator.prototype={isFirst:function(){return!this.item.previousElementSibling},isLast:function(){return this.item&&!this.nextItem},next:function(){return this.item=this.nextItem,this.item?(this.nextItem=this.item.nextElementSibling,this.item?!0:!1):!1},current:function(){return this.item}},window.ChildEnumerator=ChildEnumerator);var AtomPopup={stack:[],startOrder:2e3,show:function(t,e,n,i){if(e.style.zOrder=this.startOrder++,0==n){var o=$(t).offset();e.style.position="absolute",e.style.left=o.left+"px",e.style.top=o.top+$(t).outerHeight(!0)+"px"}e.style.visibility="visible",this.stack.push({parent:t,element:e,removeHandler:i})},peek:function(){var t=null;return this.stack.length>0&&(t=this.stack[this.stack.length-1]),t},hide:function(t){var e=this.peek();if(e&&e.element===t){t.style.visibility="hidden";var n=this.stack.pop();n.removeHandler&&n.removeHandler(n.element)}},clicked:function(t){var e=t.target,n=AtomPopup.peek();if(n){for(;e&&e!=n.element&&e!=n.parent;)e=e.parentNode;e!=n.element&&e!=n.parent&&(n.element.style.visibility="hidden",this.stack.pop(),n.removeHandler&&n.removeHandler(n.element))}}};window.AtomPopup=AtomPopup,$(window).click(function(t){AtomPopup.clicked(t)});var QueryCompiler={helpers:{any:function(t,e){return t?Atom.query(t).any(e):!1},between:function(t,e){if(!t&&!e)return!0;if(!e)return!1;var n=e[0],i=e[1];return t>=n&&i>=t},"in":function(t,e){for(var n=new AtomEnumerator(e);n.next();)if(t==n.current())return!0;return!1},equals:function(t,e){return t?t.toLowerCase()==e.toLowerCase():e?!1:!0},contains:function(t,e){return t&&e?-1!=t.toLowerCase().indexOf(e.toLowerCase()):!1},startswith:function(t,e){return t&&e?0==t.toLowerCase().indexOf(e.toLowerCase()):!1},endswith:function(t,e){return t&&e?t.toLowerCase().lastIndexOf(e.toLowerCase())==t.length-e.length:!1},containscs:function(t,e){return t?-1!=t.indexOf(e):!1},startswithcs:function(t,e){return t?0==t.indexOf(e):!1},endswithcs:function(t,e){return t?t.lastIndexOf(e)==t.length-e.length:!1}},compileList:function(t,e,n){n||(n=" && ");var i=[];for(var o in t){var r=t[o];if(void 0!==r){switch(r=JSON.stringify(r)){case"$and":i.push(QueryCompiler.compileList(r,e," && "));break;case"$or":i.push(QueryCompiler.compileList(r,e," || "));break;case"$not":i.push("!("+QueryCompiler.compileList(r,e,n)+")")}var s=o.indexOf(":");-1==s&&(s=o.lastIndexOf(" "));var a=o,l="==";-1!=s&&(a=o.substr(0,s),l=o.substr(s+1).toLowerCase());var m="";/^\!/gi.test(l)&&(m="!",l=l.substr(1)),a=JSON.stringify(a);var u=null,h=QueryCompiler.helpers[l];if("any"===l){if("{}"==r)continue;u=m+" QueryCompiler.helpers.any(Atom.get(item, "+a+" ), "+r+")"}else u=h?m+"QueryCompiler.helpers['"+l+"'](Atom.get(item,"+a+"), "+r+")":"Atom.get(item,"+a+") "+m+l+" "+r;i.push(u)}}return i.length>0?i:["true"]},compiled:{},compile:function(t){if(!t)return function(){return!0};var e=JSON.stringify(t),n=QueryCompiler.compiled[e];if(n)return n;var i=QueryCompiler.compileList(t,"item","q"),o=i.join(" && ");log(o);var r=new Function(["item","q"]," return "+o+";");return n=function(e){return r(e,t)},QueryCompiler.compiled[e]=n,n},selectCompiled:{},compileSelect:function(t){if(!t)return function(t){return t};if(t.constructor==String)return function(e){return Atom.get(e,t)};var e=JSON.stringify(t),n=QueryCompiler.selectCompiled[e];if(n)return n;var i=[];for(var o in t){var r=t[o];o=JSON.stringify(o),r?(r=JSON.stringify(r),i.push(o+":Atom.get(item,"+r+")")):i.push(o+": Atom.get(item,"+o+")")}var s="return {"+i.join(",")+"};";return n=new Function("item",s),QueryCompiler.selectCompiled[e]=n,n}},AtomQuery={firstOrDefault:function(t){for(var e=QueryCompiler.compile(t);this.next();){var n=this.current();if(e(n))return n}return null},first:function(t){for(var e=QueryCompiler.compile(t);this.next();){var n=this.current();if(e(n))return n}throw new Error("Item not found in collection")},where:function(t){for(var e=QueryCompiler.compile(t),n=[];this.next();){var i=this.current();e(i)&&n.push(i)}return new AtomEnumerator(n)},toArray:function(){for(var t=[];this.next();)t.push(this.current());return t},any:function(t){return this.firstOrDefault(t)?!0:!1},select:function(t){for(var e=QueryCompiler.compileSelect(t),n=[];this.next();){var i=this.current();n.push(e(i))}return new AtomEnumerator(n)},join:function(t){for(var e=[];this.next();)e.push(this.current());return e.join(t)},count:function(t){if(t)return this.where(t).count();for(var e=0;this.next();)e++;return e},sum:function(t){for(var e=0,n=this;n.next();){var i=n.current();t&&(i=AtomBinder.getValue(i,t)),e+=+(i||0)}return e},groupBy:function(t){for(var e=QueryCompiler.compileSelect(t),n=this,i={},o=[];n.next();){var r=n.current(),s=e(r),a=i[s];a||(a=[],i[s]=a,o.push({key:s,items:a})),a.push(r)}return Atom.query(o)}};window.AtomQuery=AtomQuery,window.QueryCompiler=QueryCompiler;for(var i in AtomQuery)AtomEnumerator.prototype[i]=AtomQuery[i];Atom.query=function(t){return void 0!==t.length?new AtomEnumerator(t):t};var AtomUI={nodeValue:AtomBrowser.isIE&&AtomBrowser.majorVersion<9?"nodeValue":"value",attributeMap:function(t,e){var n,i={},o=new AtomEnumerator(t.attributes);if(e){for(;o.next();)n=o.current(),e.test(n.nodeName)&&(e.lastIndex=0,i[n.nodeName]={value:n[AtomUI.nodeValue],node:n});return i}for(;o.next();)n=o.current(),i[n.nodeName]={value:n[AtomUI.nodeValue],node:n};return i},cloneNode:AtomBrowser.isIE&&AtomBrowser.majorVersion<8?function(t){for(var e=window.document,n=e.createElement(t.nodeName),i=new AtomEnumerator(t.attributes);i.next();){var o=i.current();try{var r=o.nodeName,s=o[AtomUI.nodeValue];if(!s)continue;n.setAttribute(r,s)}catch(a){}}for(var l=t.firstChild;l;){if(3==l.nodeType){var m=e.createTextNode(l.nodeValue);n.appendChild(m)}else 1==l.nodeType&&n.appendChild(AtomUI.cloneNode(l));l=l.nextSibling}return n}:function(t){return t.cloneNode(!0)},findPresenter:function(t){for(var e=new ChildEnumerator(t);e.next();){var n=e.current(),i=$(n).attr("atom-presenter");if(i)return n;var o=AtomUI.findPresenter(n);if(o)return o}return null},parseUrl:function(t){for(var e={},n=t.split("&"),i=new AtomEnumerator(n);i.next();){var o=i.current().split("="),r=o[0],s=o[1];s&&(s=decodeURIComponent(s)),s=AtomUI.parseValue(s),e[r]=s}return e},parseValue:function(t){var e;
return/^[0-9]+$/.test(t)?(e=parseInt(t,10),isNaN(e)||(t=e),t):/^[0-9]+\.[0-9]+/gi.test(t)?(e=parseFloat(t),isNaN(e)||(t=e),t):/true/.test(t)?t=!0:/false/.test(t)?t=!1:t},cancelEvent:function(t){var e=t.target;if(!(e&&/input/gi.test(e.nodeName)&&/checkbox/gi.test(e.type)))return t.preventDefault?t.preventDefault():t.stop(),t.returnValue=!1,t.stopPropagation(),!1},assignID:function(t){return t.id||(t.id="__waID"+AtomUI.getNewIndex()),t.id},atomParent:function(t){return t.atomControl?t.atomControl:t!==document&&t!==window&&t.parentNode?AtomUI.atomParent(t._logicalParent||t.parentNode):null},toNumber:function(t){return t?t.constructor==String?parseFloat(t):t:0},isNode:function(t){try{if(window.XMLHttpRequest&&t instanceof XMLHttpRequest)return!0}catch(e){}return t===window||t===document?!0:"object"==typeof Node?t instanceof Node:"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName},createDelegate:function(t,e){return this.getDelegate(t,e,!0)},getDelegate:function(t,e,n){if(e&&e.constructor!=String)throw new Error("methodName has to be string");var i=t.__delegates;if(!i){if(!n)return null;i={},t.__delegates=i}var o=i[e];if(!o){if(!n)return null;var r=t[e];if(!r)throw new Error("method "+e+" not found");o=function(){return r.apply(t,arguments)},i[e]=o}return o},__index:1e3,getNewIndex:function(){return this.__index=this.__index+1,this.__index},contains:function(t,e){var n=t.length,i=0;for(i=0;n>i;i++)if(t[i]==e)return!0;return!1},removeAllChildren:function(t){for(;t.hasChildNodes();){var e=t.lastChild;if(!e)break;e.atomControl&&(e.atomControl.dispose(),delete e.atomControl),$(e).remove()}},isWebkit:function(){return-1==window.navigator.userAgent.toLowerCase().indexOf("webkit")?!1:!0},isWeirdControl:function(t){return"BUTTON"==t.nodeName||"SELECT"==t.nodeName||"INPUT"==t.nodeName&&"submit"==$(t).attr("type")},parseCSS:function(t,e){var n=parseInt($(t).css(e),10);return isNaN(n)?0:n},setItemRect:function(t,e){var n=this.isWeirdControl(t);e.width&&(e.width-=this.parseCSS(t,"marginLeft")+this.parseCSS(t,"marginRight"),n||(e.width-=this.parseCSS(t,"borderLeftWidth")+this.parseCSS(t,"borderRightWidth"),e.width-=this.parseCSS(t,"paddingLeft")+this.parseCSS(t,"paddingRight")),e.width<0&&(e.width=0),t.style.width=e.width+"px"),e.height&&(e.height-=this.parseCSS(t,"marginTop")+this.parseCSS(t,"marginBottom"),n||(e.height-=this.parseCSS(t,"borderTopWidth")+this.parseCSS(t,"borderBottomWidth"),e.height-=this.parseCSS(t,"paddingTop")+this.parseCSS(t,"paddingBottom")),e.height<0&&(e.height=0),t.style.height=e.height+"px"),e.left&&(t.style.left=e.left+"px"),e.top&&(t.style.top=e.top+"px")},getPresenterOwner:function(t,e){if(t._presenters)for(var n=new AtomEnumerator(t._presenters);n.next();){var i=n.current();if(i==e)return t}return this.getPresenterOwner(t.get_atomParent(),e)},createCss:function(t){if(!t)return"";if(t.constructor==String)return t;var e=[];for(var n in t){var i=t[n];i&&e.push(n)}return e.join(" ")},createControl:function(t,e,n,i){if(!t.atomControl){if(e?e.constructor==String&&(e=WebAtoms[e]):(e=$(t).attr("atom-type"),e=WebAtoms[e]),e){var o=new e(t);return n&&(o._data=n),i&&(o._scope=i),o.createChildren(),n&&o.init(),o}return null}}};window.AtomUI=AtomUI,AtomUI.isIE7=-1!=window.navigator.userAgent.indexOf("MSIE 7.0"),AtomUI.isIE8=-1!=window.navigator.userAgent.indexOf("MSIE 8.0");var AtomBinder={getClone:function(t){var e={};if("object"==typeof t){if("undefined"!=typeof t.length)var e=new Array;for(var n in t){var i=t[n];if(void 0!==i)if(null!==i){if(!/^\_\$\_/gi.test(n)){var o=typeof i;"object"==o?e[n]=i.constructor==Date?"/DateISO("+AtomDate.toLocalTime(i)+")/":AtomBinder.getClone(i):"string"==o?e[n]=i:"number"==o?e[n]=i:"boolean"==o?e[n]=1==i?!0:!1:"date"==o&&(e[n]=i.getTime())}}else e[n]=null}}return e},setValue:function(t,e,n){if(t||void 0!==n){var i=AtomBinder.getValue(t,e);if(i!==n){var o=t["set_"+e];o?o.apply(t,[n]):t[e]=n,AtomBinder.refreshValue(t,e,i,n)}}},refreshValue:function(t,e){var n=AtomBinder.get_WatchHandler(t,e);if(void 0!=n&&null!=n){for(var i=new AtomEnumerator(n);i.next();){var o=i.current();o(t,e)}t._$_watcher&&t._$_watcher._onRefreshValue(t,e)}},getValue:function(t,e){if(null==t)return null;var n=t["get_"+e];return n?n.apply(t):t[e]},add_WatchHandler:function(t,e,n){if(null!=t){var i=AtomBinder.get_WatchHandler(t,e);i.push(n)}},get_WatchHandler:function(t,e){if(null==t)return null;var n=t._$_handlers;n||(n={},t._$_handlers=n);var i=n[e];return(void 0==i||null==i)&&(i=[],n[e]=i),i},remove_WatchHandler:function(t,e,n){if(null!=t&&void 0!==t._$_handlers&&null!==t._$_handlers){var i=t._$_handlers[e];if(void 0!=i&&null!=i)for(var o=new AtomEnumerator(i);o.next();)if(o.current()==n)return void i.splice(o.currentIndex(),1)}},invokeItemsEvent:function(t,e,n,i){var o="_items",r=AtomBinder.get_WatchHandler(t,o);if(r){for(var s=new AtomEnumerator(r);s.next();){var a=s.current();a(e,n,i)}t._$_watcher&&t._$_watcher._onRefreshItems(t,e,n,i),AtomBinder.refreshValue(t,"length")}},clear:function(t){t.length=0,AtomBinder.invokeItemsEvent(t,"refresh",0,null)},addItem:function(t,e){var n=t.length;t.push(e),AtomBinder.invokeItemsEvent(t,"add",n,e)},insertItem:function(t,e,n){t.splice(e,0,n),AtomBinder.invokeItemsEvent(t,"add",e,n)},addItems:function(t,e){for(var n=new AtomEnumerator(e);n.next();)AtomBinder.addItem(t,n.current())},removeItem:function(t,e){var n=t.indexOf(e);-1!=n&&(t.splice(n,1),AtomBinder.invokeItemsEvent(t,"remove",n,e))},removeAtIndex:function(t,e){if(-1!=e){var n=t[e];t.splice(e,1),AtomBinder.invokeItemsEvent(t,"remove",e,n)}},refreshItems:function(t){AtomBinder.invokeItemsEvent(t,"refresh",-1,null)},add_CollectionChanged:function(t,e){if(null!=t){var n="_items",i=AtomBinder.get_WatchHandler(t,n);i.push(e)}},remove_CollectionChanged:function(t,e){if(null!=t&&t._$_handlers){var n="_items",i=t._$_handlers[n];if(void 0!=i&&null!=i)for(var o=new AtomEnumerator(i);o.next();)if(o.current()==e)return void i.splice(o.currentIndex(),1)}},setError:function(t,e,n){var i=AtomBinder.getValue(t,"__errors");i||AtomBinder.setValue(t,"__errors",{}),AtomBinder.setValue(i,e,n)}};window.AtomBinder=AtomBinder,Atom.clone=AtomBinder.getClone,Atom.add=AtomBinder.addItem,Atom.insert=AtomBinder.insertItem,Atom.remove=AtomBinder.removeItem,Atom.refresh=AtomBinder.refreshValue,Atom.refreshArray=AtomBinder.refreshItems,Atom.clearArray=AtomBinder.clear,Array.prototype.enumerator=function(){return new AtomEnumerator(this)},Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=0;for(e=0;e<this.length;e++)if(t==this[e])return e;return-1});var AtomArray={split:function(t,e){e&&e.constructor==String&&(e=$.trim(e));for(var n,i=t.split(e),o=[],r=new AtomEnumerator(i);r.next();)n=r.current(),n&&n.constructor==String&&(n=$.trim(n)),o.push(n);return o},getValues:function(t,e){var n,i=t;if(e){i=[];for(var o=new AtomEnumerator(t);o.next();)n=o.current(),i.push(n[e])}return i},intersect:function(t,e,n){for(var i,o,r=[],s=new AtomEnumerator(n);s.next();)i=s.current(),o=this.getMatch(t,e,i),void 0!=o&&r.push(o);return r},getMatch:function(t,e,n){for(var i,o,r=new AtomEnumerator(t);r.next();)if(i=r.current(),o=i,e&&(o=i[e]),o==n)return i},remove:function(t,e){for(var n=new AtomEnumerator(t);n.next();){var i=n.current();if(i==e)return void t.splice(n.currentIndex(),1)}}};window.AtomArray=AtomArray;var AtomScope=function(t,e,n){return classCreator(e,n,function(t,e,n){this.owner=t,this.parent=e,n&&(this.__application=n),this.__application==this.owner&&(this._v=0,this.refreshCommand=function(){appScope._v=appScope._v+1,AtomBinder.refreshValue(appScope,"_v")}),this._refreshValue=function(t){AtomBinder.refreshValue(this,t),this.__application===this.owner&&this.__application._onRefreshValue(this,t)}},{setValue:function(t,e,n){if(AtomBinder.getValue(this,t)==e)return void(n&&this._refreshValue(t));var i=this["set_"+t];i?i.apply(this,[e]):this[t]=e,this._refreshValue(t)}})}(window,"WebAtoms.AtomScope",null);!function(t,e,n){return classCreator(e,n,function(){this._eventHandlers=[]},{bindEvent:function(t,e,n,i,o){if(null!=t){"function"==typeof n&&(o=n),o=o||AtomUI.createDelegate(this,n);var r={element:t,name:e,methodName:n,handler:o};if(i&&(r.key=i),AtomUI.isNode(t))$(t).bind(e,null,o);else if(t.addEventListener)t.addEventListener(e,o,!1);else{var s=t["add_"+e];null==s?(s=AtomBinder["add_"+e],i?s.apply(AtomBinder,[t,i,o]):s.apply(AtomBinder,[t,o])):s.apply(t,[o])}this._eventHandlers.push(r)}},unbindEvent:function(t,e,n,i){for(var o=new AtomEnumerator(this._eventHandlers),r=[];o.next();){var s=o.current();if(!(t&&t!==s.element||e&&e!==s.name||n&&n!==s.methodName||i&&i!==s.key)){if(AtomUI.isNode(s.element))$(s.element).unbind(s.name,s.handler);else if(s.element.removeEventListener)s.element.removeEventListener(e,s.handler,!1);else{var a=s.element["remove_"+s.name];null==a?(a=AtomBinder["remove_"+s.name],s.key?a.apply(AtomBinder,[s.element,s.key,s.handler]):a.apply(AtomBinder,[s.element,s.handler])):a.apply(s.element,[s.handler])}r.push(s)}}if(r.length==this._eventHandlers.length)this._eventHandlers.length=0;else for(o=new AtomEnumerator(r);o.next();){var s=o.current();AtomArray.remove(this._eventHandlers,s)}},init:function(){},dispose:function(){this.unbindEvent(null,null,null),this.__delegates&&(this.__delegates=null)}})}(this,"WebAtoms.AtomComponent",null);var AtomPromise=function(){this._success=[],this._failed=[],this._cached=!1,this._process=null,this._calls=0,this._showProgress=!0,this._showError=!0;var t=this;this.success=function(){t.onSuccess.apply(t,arguments)},this.error=function(){t.onError.apply(t,arguments)}};window.AtomPromise=AtomPromise,AtomPromise.prototype={onSuccess:function(t){this._value=t,this._process&&(this._value=this._process(this._value));for(var e=this._success,n=0;n<e.length;n++)e[n](this)},onError:function(){this.errors=arguments;for(var t=this._failed,e=0;e<t.length;e++)t[e](this)},then:function(t){return this._success.push(t),this},process:function(t){return this._process=t,this},failed:function(t){return this._failed.push(t),this},value:function(t){return void 0!==t?void(this._value=t):this._value},onInvoke:function(t){return this._invoke=t,this},invoke:function(){if(!this._persist)return this.invokePromise(),this;var t=this;return this.promiseTimeout=setTimeout(function(){t.invokePromise()},100),this},invokePromise:function(){if(this.promiseTimeout=null,this._showProgress&&(atomApplication.setBusy(!0),0===this._calls)){var t=function(){atomApplication.setBusy(!1)};this.then(t),this.failed(t)}return this._calls++,this._invoke(this),this},pushValue:function(t){var e=this;this._cached=!0,setTimeout(function(){e.onSuccess.apply(e,[t])},1)},showProgress:function(t){return this._showProgress=t,this},showError:function(t){return this._showError=t,this},persist:function(t){return this._persist=void 0===t?!0:t,this},abort:function(){return this.promiseTimeout?(clearTimeout(this.promiseTimeout),void(this.promiseTimeout=null)):(this._failed.length=0,this._success.length=0,this._showProgress&&atomApplication.setBusy(!1),void(this.handle&&this.handle.abort()))}},AtomPromise.getUrl=function(t){var e=location.href,n=e.indexOf("#");return-1!==n&&(e=e.substr(0,n)),t?(n=e.lastIndexOf("/"),-1!==n&&(e=e.substr(0,n+1)),/^(http|https)\:\/\//gi.test(t)?t:/^\//gi.test(t)?t:/^\./gi.test(t)?(t=t.substr(1),/\/$/gi.test(e)&&/^\//gi.test(t)&&(t=t.substr(1)),e+t):e+t):e},AtomPromise.parseDates=function(t){if(!t)return t;var e=typeof t;if("object"===e){if("undefined"!=typeof t.length){for(var n=0;n<t.length;n++)t[n]=AtomPromise.parseDates(t[n]);return t}for(var i in t){var o=t[i];o&&(t[i]=AtomPromise.parseDates(o))}}return("string"==typeof t||t.constructor===String)&&/^\/date\(/gi.test(t)&&/\)\/$/gi.test(t)?AtomDate.parse(t):t},AtomPromise.ajax=function(t,e,n){var i=new AtomPromise;n||(n={type:"GET",dataType:"text",data:null}),AtomConfig.ajax.versionUrl&&void 0!==n.versionUrl&&n.versionUrl&&(e=e||{},e[AtomConfig.ajax.versionKey]=AtomConfig.ajax.version),n.success=i.success,n.error=i.error,void 0===n.cache&&(n.cache=!1);var o=t,r=AtomConfig.ajax.headers;if(r){n.headers||(n.headers={});for(var s in r){var a=r[s];n.headers[s]=a,AtomConfig.debug&&log("Header set: "+s+"="+a)}}var l=AtomConfig.ajax.statusCode;if(l){var m=n.statusCode||{};for(var s in l){var a=l[s];m[s]||(m[s]=a)}n.statusCode=m}var u=n,h=u.data;h&&(i.data=AtomBinder.getClone(h));var d=AtomConfig.ajax.jsonPostEncode;d?u=d(u):u.data={formModel:JSON.stringify(h)};var c=u.attachments;if(c&&c.length){for(var p=new FormData,f=new AtomEnumerator(c);f.next();)p.append("file"+f.currentIndex(),f.current());if(h)for(var s in h)p.append(s,h[s]);u.type="POST",u.xhr=function(){var t=$.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(t){if(t.lengthComputable){var e=Math.round(100*t.loaded/t.total);AtomBinder.setValue(atomApplication,"progress",e)}},!1),t},u.cache=!1,u.contentType=!1,u.processData=!1}if(e){var v={};if(!u.sendRawQueryString)for(var s in e){var a=e[s];if(a&&"object"==typeof a){if(a=JSON.stringify(AtomBinder.getClone(a)),void 0===a)continue;if(null===a)continue}v[s]=a}o=Atom.url(t,v)}return t&&i.onInvoke(function(){i.handle=$.ajax(o,u)}),i.failed(function(){var t=i.errors[0].responseText;t&&"Internal Server Error"===i.errors[2]||(t=i.errors[2]),i.error={msg:t},i._showError&&i.error.msg&&Atom.alert(i.error.msg)}),i.then(function(t){var e=t.value();e=AtomPromise.parseDates(e),e&&e.items&&e.merge&&(e.items.total=e.total,e=e.items,t.value(e))}),i.showError(!0),i.showProgress(!0),i},AtomPromise.get=function(t,e,n){return n=n||{},n.type=n.type||"get",n.dataType=n.dataType||"text",AtomPromise.ajax(t,e,n,"get")},AtomPromise.plugins={},AtomPromise.json=function(t,e,n){n=n||{},n.type=n.type||"get",n.dataType=n.dataType||"json";var i=null,o=t.indexOf("://");if(-1!==o){var r=t.substr(0,o);/http|https/i.test(r)||(t=t.substr(o+3),i=AtomPromise.plugins[r])}return(i=i||AtomPromise.ajax)(t,e,n,"json")},AtomPromise.cache={},AtomPromise.cacheInProgress={},AtomPromise.cachedPromise=function(t,e){var n=AtomPromise.cache[t];return!n&&window.sessionStorage&&(n=window.sessionStorage["__AP"+t],n&&(n=JSON.parse(n),AtomPromise.cache[t]=n)),n?(e.onInvoke(function(){e.pushValue(n)}),e):(e.then(function(e){AtomPromise.cache[t]=e.value(),window.sessionStorage&&(window.sessionStorage["__AP"+t]=JSON.stringify(e.value()))}),e)},AtomPromise.cachedJson=function(t,e,n){var i=(new Date,AtomConfig.ajax.version),o=AtomConfig.ajax.versionKey+"="+i;-1===t.indexOf("?")?o="?"+o:/\&$/.test(t)||(o="&"+o),t+=o,n=n||{},n.cache=!0,n.ifModified=!0,n.versionUrl=!1;var r=AtomPromise.ajax(t,e,n,"json");return AtomPromise.cachedPromise(t,r)},AtomPromise.configCache={},AtomPromise.configLabel=function(t,e,n){if(null===e||void 0===e)return"";n=n||{};var i=n.valuePath||"value",o=n.labelPath||"label",r=n.isNumber||!1;r&&"number"!=typeof e&&(e=parseFloat(e));var s=new AtomPromise;return s.onInvoke(function(){var n=AtomPromise.configCache[t];if(n)return n=n[e],n=n?n[o]:"",void s.pushValue(n);var a=AtomPromise.cachedJson(t);a.then(function(n){for(var a="",l={},m=new AtomEnumerator(n.value());m.next();){var u=m.current();a=u[i],r&&"number"!=typeof a&&(a=parseFloat(a)),l[a]=u}AtomPromise.configCache[t]=l,l=l[e],l=l?l[o]:"",s.pushValue(l)}),a.invoke()}),s},AtomPromise.prototype.insertItem=function(t,e,n){return this.then(function(i){var o=i.value();o._$_itemInserted||(n&&(o=o[n]),-1===t?o.push(e):o.splice(t||0,0,e),o._$_itemInserted=!0)})};var AtomLocalStorage={list:function(){},add:function(){},remove:function(){},clear:function(){},set:function(){},get:function(){}};AtomPromise.plugins["local-storage"]=function(t,e,n){var i=t.split("/"),o=i[0],r=i[1],s=new AtomPromise;return s.onInvoke(function(t){var i=AtomLocalStorage,s=i[r](o,e,n.data);t.pushValue(s)}),s},function(t,e){return classCreatorEx({name:"WebAtoms.AtomBinding",base:e,start:function(t,e,n,i,o,r,s,a){if(this.element=e,this.control=t,this.vf=s,this.key=n,this.events=a,i&&i.constructor!=String){this.pathList=[],this.path=null;for(var l=new AtomEnumerator(i);l.next();){for(var m=new AtomEnumerator(l.current()),u=[];m.next();)u.push({path:m.current(),value:null});this.pathList.push(u)}}else{var l=new AtomEnumerator(i.split("."));for(this.path=[];l.next();)this.path.push({path:l.current(),value:null})}this.twoWays=o,this.jq=r,this._isUpdating=!1},methods:{onPropChanged:function(){if(null!=this.path&&0!=this.path.length){for(var t=new AtomEnumerator(this.path),e=this.control,n=null;t.next();){if(n=t.current(),n.value=e,!e)return;t.isLast()||(e=AtomBinder.getValue(e,n.path))}var i=null;if(this.jq)switch(this.key){case"valueAsDate":i=this.element.valueAsDate;break;case"checked":i=this.element.checked?!0:!1;break;default:i=$(this.element).val()}else i=AtomBinder.getValue(this.control,this.key);AtomBinder.setValue(e,n.path,i)}},onDataChanged:function(){if(!this._isUpdating&&void 0!==arguments&&0!=arguments.length){var t,e=this.control;if(this.pathList){var n=[];for(t=new AtomEnumerator(this.pathList);t.next();)n.push(this.evaluate(e,t.current()));for(t=new AtomEnumerator(n);t.next();)if(void 0===t.current())return;this.setValue(n)}else{var i=this.path,n=this.evaluate(e,i);void 0!==n&&this.setValue(n)}}},evaluate:function(t,e){for(var n=null,i=null,o=new AtomEnumerator(e);t&&o.next();){if(i=o.current(),n=AtomBinder.getValue(t,i.path),!/scope|appScope|atomParent|templateParent|localScope/gi.test(i.path)){i.value?i.value!=t&&(this.unbindEvent(i.value,"WatchHandler",null,i.path),this.bindEvent(t,"WatchHandler","onDataChanged",i.path)):this.bindEvent(t,"WatchHandler","onDataChanged",i.path)}i.value=t,t=n}return void 0===n&&AtomConfig.debug&&log("Undefined:"+this.control._element.id+" -> "+$.map(e,function(t){return t.path}).join(".")),n},onValChanged:function(){this.onPropChanged(null,null)},setup:function(){if(this.twoWays)if(this.jq){if(this.bindEvent(this.element,"change","onValChanged"),this.events)for(var t=new AtomEnumerator(this.events.split(","));t.next();)this.bindEvent(this.element,t.current(),"onValChanged")}else this.bindEvent(this.control,"WatchHandler","onPropChanged",this.key);this.onDataChanged(this,null)},setValue:function(t){!this.pathList&&this.vf&&(t=[t]),this.vf&&(t.push(Atom),t.push(AtomPromise),t=this.vf.apply(this,t)),t instanceof AtomPromise&&(t._persist=!0),this._lastValue=t,this._isUpdating=!0,this.control.setLocalValue(this.key,t,this.element,!0),this._isUpdating=!1}}})}(window,WebAtoms.AtomComponent.prototype);var allControls={};window.allControls=allControls,function(t,e){return classCreator(t,e,function(){this._paused=!1,this.queue=[],this.onTimeout=function(){if(!this._paused){if(0==this.queue.length){var t=atomApplication._element;return void(("hidden"==t.style.visibility||"hidden"==$(t).css("visibility"))&&(t.style.visibility="visible",t.atomControl.updateUI()))}var e=this.queue.shift();e(),window.setTimeout(this._onTimeout,1)}};var t=this;this._onTimeout=function(){t.onTimeout()}},{pause:function(){this._paused=!0},start:function(){this._paused=!1,window.setTimeout(this._onTimeout,1)},callLater:function(t){this.queue.push(t),this._paused||this.start()},setupControls:function(){var t=$("[atom-type]").first()[0];if(void 0==t.atomControl||null==t.atomControl){var e=$(t).attr("atom-type");$(t).removeAttr("atom-type");var n=new WebAtoms[e](t);n.setup()}}})}("WebAtoms.AtomDispatcher",null),WebAtoms.dispatcher=new WebAtoms.AtomDispatcher,function(t,e,n){return classCreator(e,n,function(){},{get_owner:function(){return this},get_appScope:function(){return appScope},get_scope:function(){if(void 0===this._scope){var t=this.get_atomParent(this._element._logicalParent||this._element.parentNode);return t?t._localScope||t.get_scope():appScope}return this._scope},get_localScope:function(){if(void 0===this._localScope){var t=this.get_atomParent(this._element._logicalParent||this._element.parentNode);if(t)return t.get_localScope();throw new Error("Local Scope does not exist")}return this._localScope},set_scope:function(t){var e=this.get_scope();for(var n in t){if(/^(application|owner|app|parent)$/gi.test(n))throw new Error("Invalid name for the scope property");e[n]||(e[n]=t[n])}},get_name:function(){return this._name},getTemplate:function(t){var e=this["_"+t];return void 0!==e&&null!==e?e:(e=Templates.get(this.constructor,t))?(this["_"+t]=e,e):null}},{next:null,value:void 0})}(window,"WebAtoms.AtomUIComponent",WebAtoms.AtomComponent.prototype),Templates.compiled={};var document=window.document;Templates.compileElement=function(t){var e=new AtomEnumerator(t);e.next();var n=e.current(),i=document.createElement(n);if(!e.next())return i;if(n=e.current())for(var o in n)i.setAttribute(o,n[o]);for(;e.next()&&(n=e.current());)i.appendChild(n.constructor==String?document.createTextNode(n):Templates.compileElement(n));return i},Templates.compileJsonML=function(t){if(1==t.length)return Templates.compileElement(t[0]);for(var e=[],n=new AtomEnumerator(t);n.next();)e.push(Templates.compileElement(n.current()));return e},Templates.compile=function(t,e,n){var i=document.createElement("div");return i.innerHTML=n,1==$(i).children().length&&(n=AtomUI.cloneNode(i.firstElementChild||i.children[0])),n},Templates.get=function(t,e){var n=t.__typeName+"."+e,i=this.compiled[n];return i?i:(i=Templates.jsonML[n],i?i=Templates.compileJsonML(i):t.__baseType&&(i=Templates.get(t.__baseType,e)),i?(this.compiled[n]=i,i):null)},Templates.compileType=function(t){var e=t.__typeName,n=e.split(".");n=n[n.length-1];var i=this.compiled[e];if(i)return i;i={};var o=this[e]||this[n];if(o)for(var r in o)i[r]=this.compile(t,r,o[r]);if(t.__baseType){var s=this.compileType(t.__baseType);for(var a in s)i[a]||(i[a]=s[a])}this.compiled[e]=i;var r=this;return delete r[e],delete r[n],i};var AtomBinders={"{":function(t,e,n,i){n=n.substr(1,n.length-2);var o=AtomEvaluator.parse(n);if(o.path){var r=new AtomEnumerator(o.path);for(n=[];r.next();){for(var s=new AtomEnumerator(r.current()),a=t;s.next();)a=AtomBinder.getValue(a,s.current());n.push(a)}}else n=[n];n.push(Atom),n.push(AtomPromise),n=o.method.apply(null,n),t.setLocalValue(e,n,i)},"[":function(ctrl,key,value,element){value=value.substr(1,value.length-2);var be=AtomEvaluator.parse(value);0==be.length?(value=eval(value),AtomBinder.setValue(ctrl,key,value)):1==be.length&&be.path[0]==be.original?ctrl.bind(element,key,value,!1):ctrl.bind(element,key,be.path,!1,be.method)},"$[":function(t,e,n,i){var o=n.lastIndexOf("]"),r=null;o<n.length-1&&(r=n.substr(o+2),r=r.substr(0,r.length-1)),n=n.substr(0,o),n=n.substr(2),/^(@|\$)/g.test(n)&&(n=n.substr(1)),t.bind(i,e,n,!0,null,r)},"^[":function(t,e,n,i){n=n.substr(2,n.length-3),/^(@|\$)/g.test(n)&&(n=n.substr(1)),t.bind(i,e,n,!0,null,"keyup,keydown,keypress,blur")}},AtomProperties={any:function(t,e,n){t.setAttribute(n,e)},isEnabled:function(t,e){e?$(t).removeAttr("disabled"):$(t).attr("disabled","disabled")},checked:function(t,e){t.checked!=e&&(t.checked=e?!0:!1)},value:function(t,e){/date|datetime/gi.test(t.type)?t.valueAsDate=AtomDate.parse(e):$(t).val(e)},valueAsDate:function(t,e){t.valueAsDate=AtomDate.parse(e)},text:function(t,e){t.innerHTML="";var n=document.createTextNode(e);t.appendChild(n)},html:function(t,e){t.innerHTML=e},absPos:function(t,e){AtomProperties.setPosition(!0,t,e)},relPos:function(t,e){AtomProperties.setPosition(!1,t,e)},"class":function(t,e){t.atomClass&&$(t).removeClass(t.atomClass),e&&(e=AtomUI.createCss(e),e&&$(t).addClass(e),t.atomClass=e)},setPosition:function(a,e,val){var l=val;l.constructor==String&&(l=eval("["+l+"]")),e.style.position=a?"absolute":"relative";var left=l[0],top=l[1];if(null!==left&&(e.style.left=left+"px"),null!==top&&(e.style.top=top+"px"),l.length>2){var width=l[2],height=l[3];void 0!==width&&null!==width&&(e.style.width=width+"px"),void 0!==height&&null!==height&&(e.style.height=height+"px")}}};window.AtomProperties=AtomProperties,function(t,e,n){return classCreatorEx({name:e,base:n,start:function(t){t.atomControl=this,this._element=t,this.dispatcher=WebAtoms.dispatcher,this.bindings=[],this._isVisible=!0,t.id&&appScope&&(appScope[t.id]=this),AtomUI.assignID(t),allControls[t.id]=this},properties:{layout:null,loadNext:null,next:null,merge:void 0,value:void 0},methods:{set_merge:function(t){if(this._mergeData2=null,t){var e=t.data;e&&(Atom.merge(this.get_data(),e,!0),this._mergeData2=e),e=t.scope,e&&Atom.merge(this.get_scope(),e,!0),e=t.appScope,e&&Atom.merge(this.get_appScope(),e,!0),e=t.localScope,e&&Atom.merge(this.get_localScope(),e,!0),e=t.owner,e&&Atom.merge(this,e,!0)}},invokeAction:function(t,e){if(t)if(t.constructor==String)location.href=t;else{var n=t;if(n.atomControl)n=n.atomControl,n.refresh?n.refresh(this.get_scope(),this):Atom.alert("no default action defined");else if(n._element)n.refresh(this.get_scope(),this);else if("function"==typeof n)n(this.get_scope(),this,e);else{if(n.length){for(var i=new AtomEnumerator(n);i.next();)this.invokeAction(i.current(),e);return}var t=n.timeOut||n.timeout;if(t){var o=this,r=100;return t.hasOwnProperty("length")&&t.length>1&&(r=t[0],t=t[1]),void setTimeout(function(){o.invokeAction(t)},r)}if(this.set_merge(n),t=n.confirm){var s="Are you sure?";t.hasOwnProperty("length")&&(t.length>1?(s=t[0],t=t[1]):t=t[0]);var o=this,a=t,l=e;Atom.confirm(s,function(){o.invokeAction(a,l)})}if(t=n.alert,t&&Atom.alert(t),t=n.next)return void this.invokeAction(t,e);t=n.control,t&&allControls[t].refresh()}}},refresh:function(){},get_element:function(){return this._element},clearBinding:function(t,e){for(var n,i=new AtomEnumerator(this.bindings),o=[];i.next();)n=i.current(),t&&n.element!=t||e&&n.key!=e||(n.dispose(),o.push(n));for(i=new AtomEnumerator(o);i.next();)AtomArray.remove(this.bindings,i.current())},addBinding:function(t,e,n,i,o,r,s,a){this.clearBinding(e,n);var l=new WebAtoms.AtomBinding(t,e,n,i,o,r,s,a);this.bindings.push(l),l.setup()},get_atomParent:function(e){if(null==e){if(!this._element._logicalParent&&!this._element.parentNode)return null;e=this._element._logicalParent||this._element.parentNode}return e.atomControl?e.atomControl:e!==document&&e!==t&&e.parentNode?this.get_atomParent(e._logicalParent||e.parentNode):null},get_templateParent:function(t){if(t||(t=this._element),t._templateParent)return t._templateParent;var e=t._logicalParent||t.parentNode;if(!e)throw new Error("Could not find templateParent");return this.get_templateParent(t._logicalParent||t.parentNode)},get_data:function(){if(void 0===this._data){var t=this.get_atomParent(this._element._logicalParent||this._element.parentNode);if(t)return t.get_data()}return this._data},set_data:function(t){this._data=t,this.mergeData(),this.updateChildBindings(this._element)},mergeData:function(){this._mergeData2&&Atom.merge(this.get_data(),this._mergeData2,!0)},updateChildBindings:function(t){for(var e=new ChildEnumerator(t);e.next();){var n=e.current();if(n.atomControl&&n.atomControl._created){var i=n.atomControl;if(void 0!==i._data)continue;AtomBinder.refreshValue(i,"data"),i.mergeData()}this.updateChildBindings(n)}},initProperties:function(){if(!this._disposed){var t=this.get_element();this.setProperties(t),this._created=!0,this.onCreated(),this.onLoaded()}},createChildren:function(){this.onCreateChildren(this._element);var t=this.getTemplate("template");if(t&&0==$(this._element).children().length){if(t.constructor==String){this._element.innerHTML=t;var e=this;$(this._element).children().each(function(){this._templateParent=e})}else if(AtomUI.isNode(t))t=AtomUI.cloneNode(t),t._templateParent=this,this._element.appendChild(t);else for(var n=new AtomEnumerator(t);n.next();){var i=n.current();i=AtomUI.cloneNode(i),i._templateParent=this,this._element.appendChild(i)}this.onCreateChildren(this._element)}},onCreateChildren:function(t){for(var e,n=new ChildEnumerator(t);n.next();){e=n.current();var i=AtomUI.attributeMap(e,/^atom\-(template|presenter|type|template\-name)$/gi),o=i["atom-template"];if(o)e.removeAttributeNode(o.node),t.templateOwner=!0,this["_"+o.value]=e,t.removeChild(e);else{var r=i["atom-template-name"];if(r)e.removeAttributeNode(r.node),this._scopeTemplates=this._scopeTemplates||{},this._scopeTemplates[r.value]=e,t.removeChild(e);else{var s=i["atom-presenter"];if(s){var a=AtomUI.getPresenterOwner(this,s.value);a["_"+s.value]=e}var l=i["atom-type"];l?AtomUI.createControl(e,l.value):this.onCreateChildren(e)}}}},onLoaded:function(){},onUpdateUI:function(){this._layout?this._layout.doLayout(this._element):this.updateChildUI(this.get_element())},updateUI:function(){var t=this;this.dispatcher.callLater(function(){t.onUpdateUI()})},updateChildUI:function(t){t||(t=this._element);for(var e=new ChildEnumerator(t);e.next();){var n=e.current();n.atomControl?n.atomControl.updateUI():this.updateChildUI(n)}},onCreated:function(){this.updateUI()},setProperties:function(t){var e,n,i,o=t.attributes,r=new AtomEnumerator(o),s=[],a="value";AtomBrowser.isIE&&AtomBrowser.majorVersion<9&&(a="nodeValue");for(var l={};r.next();)i=r.current(),e=i.nodeName,n=i[a],/^atomControl$/g.test(e)||(/^atom\-type$/.test(e)?s.push(i):/^(atom|bind|style|event)\-/g.test(e)&&(/^(style|event)\-/g.test(e)||(e=e.substr(5)),n&&(/(^style$|dock)/.test(e)||s.push(i),e=$.camelCase(e),l[e]=n)));for(e in l)this.setValue(e,l[e],!0,t);for(r=new AtomEnumerator(s);r.next();)t.removeAttributeNode(r.current());for(var m=new ChildEnumerator(t);m.next();){var u=m.current();u.atomControl||this.setProperties(u)}},setValue:function(t,e,n,i){if(e&&e.constructor==String){var o=e[0],r=AtomBinders[o];if(r)return void r(this,t,e,i);if(o+=e[1],r=AtomBinders[o])return void r(this,t,e,i)}this.setLocalValue(t,e,i)},setLocalValue:function(t,e,n,i){if(void 0!==e){if(e&&e instanceof AtomPromise){n._promisesQueue=n._promisesQueue||{};var o=n._promisesQueue[t];o&&o.abort(),n._promisesQueue[t]=e,e._persist&&(this._promises=this._promises||{},this._promises[t]=e);var r=this;return e.then(function(e){n._promisesQueue[t]==e&&(n._promisesQueue[t]=null),n._promisesQueue[t]=null,r.setLocalValue(t,e.value(),n,!0),r._loadNext&&r.invokeAction(r._loadNext)}),e.failed(function(e){n._promisesQueue[t]==e&&(n._promisesQueue[t]=null)}),void e.invoke()}if(this._element==n){var s=this["set_"+t];if(null!=s){if(i){var a=AtomBinder.getValue(this,t);if(a==e)return}return s.apply(this,[e]),void(i&&AtomBinder.refreshValue(this,t))}}if(/^style/g.test(t)&&t.length>5){var l=t.substr(5);return l=String.fromCharCode(l.charCodeAt(0)).toLowerCase()+l.substr(1),void(n.style[l]=e)}if(/^event/g.test(t)&&t.length>5){var l=t.substr(5);l=String.fromCharCode(l.charCodeAt(0)).toLowerCase()+l.substr(1);var m=this;return this.unbindEvent(n,l),void this.bindEvent(n,l,null,null,function(t){m.invokeAction(e,t)})}var u=AtomProperties[t]||AtomProperties.any;u&&u(n||this._element,e,t)}},bind:function(e,n,i,o,r,s){if(null==i)return void this.clearBinding(e,n);var a=this;i&&i.constructor==String&&/^window\./g.test(i)&&(a=t);var l=this.get_element(),m=l!=e;if(!m){var u=this["get_"+n];(void 0==u||null==u)&&(m=!0)}switch(n){case"value":/input/gi.test(e.nodeName)&&(m=!0),this.addBinding(a,e,"value",i,o,m,r,s);break;case"text":this.addBinding(a,e,"text",i,!1,!0,r,s);break;default:this.addBinding(a,e,n,i,o,m,r,s)}},onInitialized:function(){},init:function(){n.init.apply(this,arguments);var t=this.get_element(),e=AtomUI.attributeMap(t,/^atom\-(name|local\-scope)$/gi),i=e["atom-name"];if(i){if(/^(app|window|owner|scope|localScope|parent)$/gi.test(i.value))throw new Error("Invalid Control Name '"+i.value+"'");var o=this.get_scope();AtomBinder.setValue(o,i.value,this),this._name=i.value,t.removeAttributeNode(i.node)}i=e["atom-local-scope"],i&&(this._localScope=new AtomScope(this,this.get_scope(),atomApplication),this._scope=this._localScope,this._name&&(this._localScope[this._name]=this),t.removeAttributeNode(i.node));var r=this._scopeTemplates;if(r){var o=this.get_scope();for(var s in r){var a=r[s];AtomBinder.setValue(o,s,a)}}var l=this;WebAtoms.dispatcher.callLater(function(){l.initProperties()}),this.initChildren(this._element),WebAtoms.dispatcher.callLater(function(){l.onInitialized()
})},dispose:function(t){if(t){var e=t.atomControl;return e?e.dispose():(this.clearBinding(t),this.disposeChildren(t)),void $(t).remove()}this._disposed=!0,this.disposeChildren(this._element),this.clearBinding(),this.bindings.length=0,n.dispose.apply(this,arguments)},disposeChildren:function(t){for(var e=AtomBrowser.isIE&&AtomBrowser.majorVersion<9,n=new ChildEnumerator(t);n.next();){var i=n.current();i.atomControl?(i.atomControl.dispose(),e?i.atomControl=void 0:delete i.atomControl):(this.clearBinding(i),this.unbindEvent(i),this.disposeChildren(i))}try{t.innerHTML=""}catch(o){$(t).html("")}},get_innerTemplate:function(){return this._template},set_innerTemplate:function(t){if(this._template!==t||!this._created){if(!this._created){var e=this;return void WebAtoms.dispatcher.callLater(function(){e.set_innerTemplate(t)})}this._template=t,this.disposeChildren(this._element),this.createChildren(),this.setProperties(this._element),this.initChildren(this._element),this.updateUI()}},initChildren:function(t){for(var e,n,i=new ChildEnumerator(t),o=[];i.next();)if(e=i.current(),"SCRIPT"!=e.nodeName)n=e.atomControl,n?n.init():this.initChildren(e);else{var r=$.trim(e.innerHTML);if(/^\(\{/.test(r)&&/\}\)$/.test(r))try{r=new Function("return "+r+";")();var s=this._localScope||this.get_scope();for(var a in r)s[a]||(s[a]=r[a])}catch(l){log(JSON.stringify(l)),alert(JSON.stringify(l))}o.push(e)}for(i=new AtomEnumerator(o);i.next();)t.removeChild(i.current())}}})}(window,"WebAtoms.AtomControl",WebAtoms.AtomUIComponent.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomItemsControl",base:e,start:function(){this._selectedItems=[],this._selectedElements=[],this._selectedIndexSet=!1,this._onUIChanged=!1,this._itemsPresenter=null,this._itemsPanel=null,this._presenters=["itemsPresenter"],this._childItemType=WebAtoms.AtomControl},properties:{allowSelectFirst:!1,allowMultipleSelection:!1,uiVirtualize:!1,defaultValue:null,autoScrollToSelection:!1,selectAll:void 0,labelPath:"label",valuePath:"value",sortPath:null,valueSeparator:null,postData:null,postUrl:null,confirm:!1,confirmMessage:null,filter:null,items:null,itemTemplate:null},methods:{get_postData:function(){return this._postData||this.get_selectedItem()},get_allValues:function(){if(this._valueSeparator&&this._valuePath){for(var t=[],e=this._valuePath,n=function(t){return t[e]},i=Atom.query(this.get_dataItems());i.next();)t.push(n(i.current()));return t.join(this._valueSeparator)}},get_value:function(){if(this._allowMultipleSelection){var t=this._selectedItems;return 0==t.length?void 0!==this._value?this._value:null:(t=AtomArray.getValues(t,this._valuePath),this._valueSeparator&&(t=t.join(this._valueSeparator)),t)}var e=this.get_selectedItem();return e?(this._valuePath&&(e=e[this._valuePath]),e):void 0!==this._value?this._value:null},set_value:function(t){if(this._value=t,void 0===t||null===t)return void AtomBinder.clear(this._selectedItems);var e=this.get_dataItems();this._allowMultipleSelection&&this._valueSeparator?(t.constructor!=String&&(t=""+t),t=AtomArray.split(t,this._valueSeparator)):t=[t];var n=AtomArray.intersect(e,this._valuePath,t);this._selectedItems.length=0;for(var i=new AtomEnumerator(n);i.next();)this._selectedItems.push(i.current());AtomBinder.refreshItems(this._selectedItems)},set_sortPath:function(t){this._sortPath=t,t&&this.onCollectionChangedInternal("refresh",-1,null)},set_selectAll:function(t){if(void 0!==t&&null!==t){this._selectedItems.length=0;var e=this.get_dataItems();if(t&&e)for(var n=new AtomEnumerator(e);n.next();)this._selectedItems.push(n.current());AtomBinder.refreshItems(this._selectedItems)}},refresh:function(){this._promises&&this._promises.items&&this._promises.items.invoke()},set_defaultValue:function(t){this.get_value()||AtomBinder.setValue(this,"value",t)},invokePost:function(){if(this._onUIChanged&&(!this._confirm||confirm(this._confirmMessage))){if(!this._postUrl)return void this.invokeAction(this._next);var t=this.get_postData();if(null!==t&&void 0!==t){t=AtomBinder.getClone(t);var e=this,n=AtomPromise.json(this._postUrl,null,{type:"POST",data:t});n.then(function(){e.invokeNext()}),n.invoke()}}},invokeNext:function(){this.invokeAction(this._next)},set_filter:function(t){t!=this._filter&&(this._filter=t,this._filteredItems=null,this.applyFilter())},applyFilter:function(){this._filter&&this.hasItems()&&this.onCollectionChangedInternal("refresh",-1,null)},isSelected:function(t){for(var e=new AtomEnumerator(this._selectedItems),n=null;e.next();)if(n=e.current(),n==t)return!0;return!1},get_dataItems:function(){var t=this._items;if(this.hasItems()){var e=this._filter;if(e){var n=[];if("object"==typeof e)n=Atom.query(t).where(e).toArray();else for(var i=new AtomEnumerator(t);i.next();){var o=i.current();e(o,i.currentIndex())&&n.push(o)}this._filteredItems=n,t=n}var r=this._sortPath;if(r)if(r.constructor==String){var s=!1,a=r.indexOf(" ");if(-1!=a){var l=r.substr(a+1);r=r.substr(0,a),s=/desc/gi.test(l)}var e=s?function(t,e){return e[r].localeCompare(t[r])}:function(t,e){return t[r].localeCompare(e[r])};t=t.sort(e)}else t=t.sort(r);return t}return $(this._itemsPresenter).children()},getIndexOfDataItem:function(t){if(null==t)return-1;for(var e=this.get_dataItems(),n=new AtomEnumerator(e);n.next();)if(n.current()==t)return n.currentIndex();return-1},getDataItemAtIndex:function(t){return-1==t?null:this.get_dataItems()[t]},get_childAtomControls:function(){for(var t=this._itemsPresenter||this._element,e=[],n=new ChildEnumerator(t);n.next();){var i=n.current();i=!i||i.atomControl,i&&e.push(i)}return e},get_selectedChild:function(){var t=this.get_selectedItem();if(!this.hasItems())return t;for(var e=new ChildEnumerator(this._itemsPresenter);e.next();){var n=e.current();if(n.atomControl.get_data()==t)return n}return null},set_allowSelectFirst:function(t){t=t?"false"!=t:t,this._allowSelectFirst=t},get_selectedItem:function(){return this._selectedItems.length>0?this._selectedItems[0]:null},set_selectedItem:function(t){t?(this._selectedItems.length=1,this._selectedItems[0]=t):this._selectedItems.length=0,AtomBinder.refreshItems(this._selectedItems)},get_selectedItems:function(){return this._selectedItems},set_selectedItems:function(){throw new Error("Not yet implemented")},get_selectedIndex:function(){var t=this.get_selectedItem();return this.getIndexOfDataItem(t)},set_selectedIndex:function(t){AtomBinder.setValue(this,"selectedItem",this.getDataItemAtIndex(t))},updateChildSelections:function(){},bringSelectionIntoView:function(){if(!this._allowSelectFirst||0!=this.get_selectedIndex())for(var t=new ChildEnumerator(this._itemsPresenter);t.next();){var e=t.current(),n=e.atomControl?e.atomControl.get_data():e;if(this.isSelected(n))return void e.scrollIntoView()}},updateSelectionBindings:function(){AtomBinder.refreshValue(this,"value"),AtomBinder.refreshValue(this,"selectedItem"),AtomBinder.refreshValue(this,"selectedItems"),AtomBinder.refreshValue(this,"selectedIndex")},onSelectedItemsChanged:function(t,e,n){this._onUIChanged||(this.updateChildSelections(t,e,n),this._autoScrollToSelection&&this.bringSelectionIntoView()),this.updateSelectionBindings(),this.updateUI(),this.invokePost()},hasItems:function(){return void 0!=this._items&&null!=this._items},get_items:function(){return this._items},set_items:function(t){var e=this;this._items&&this.unbindEvent(this._items,"CollectionChanged",null),this._items=t,this._filteredItems=null,null!=t&&(this.bindEvent(this._items,"CollectionChanged",function(){e.onCollectionChangedInternal.apply(e,arguments)}),this.onCollectionChangedInternal("refresh",-1,null))},set_itemTemplate:function(t){this._itemTemplate=t,this.onCollectionChangedInternal("refresh",-1,null)},onCollectionChangedInternal:function(t,e,n){if(this._created){Atom.refresh(this,"allValues");var i=this.get_value();this.hasItems()&&(this.onCollectionChanged(t,e,n),i||this._allowSelectFirst||AtomBinder.clear(this._selectedItems)),(null==i||(this.set_value(i),-1==this.get_selectedIndex()))&&this.selectDefault()}},selectDefault:function(){return this._allowSelectFirst&&this.get_dataItems().length>0?void this.set_selectedIndex(0):void this.updateSelectionBindings()},onScroll:function(){this.scrollTimeout&&clearTimeout(this.scrollTimeout);var t=this;this.scrollTimeout=setTimeout(function(){t.scrollTimeout=0,t.onCollectionChangedInternal("refresh",-1,null)},1e3)},onCollectionChanged:function(t,e,n){if(/remove/gi.test(t)){for(var i=new ChildEnumerator(this._itemsPresenter);i.next();){var o=i.current();if(o.atomControl&&o.atomControl.get_data()==n){o.atomControl.dispose(),$(o).remove();break}}return void this.updateUI()}var r=this.get_scope(),s=this.getTemplate("itemTemplate");if(s&&(s=$(s).attr("atom-type"),s&&(this._childItemType=s)),/add/gi.test(t)){WebAtoms.dispatcher.pause();for(var a=new AtomEnumerator(this._items),i=new ChildEnumerator(this._itemsPresenter);a.next();){i.next();var o=i.current();if(a.currentIndex()==e){var l=this.createChildElement(r,this._itemsPresenter,n,a,o);this.applyItemStyle(l,n,a.isFirst(),a.isLast());break}if(a.isLast()){var l=this.createChildElement(r,this._itemsPresenter,n,a);this.applyItemStyle(l,n,a.isFirst(),a.isLast());break}}return WebAtoms.dispatcher.start(),void this.updateUI()}{var m=this._itemsPresenter;this.get_dataItems()}this.disposeChildren(m),WebAtoms.dispatcher.pause();for(var u,h,d=this.get_dataItems(!0),a=new AtomEnumerator(d);a.next();){var u=a.current(),h=this.createChildElement(r,m,u,a);this.applyItemStyle(h,u,a.isFirst(),a.isLast())}WebAtoms.dispatcher.start(),AtomBinder.refreshValue(this,"childAtomControls")},set_innerTemplate:function(){this._itemsPresenter=this._element,e.set_innerTemplate.apply(this,arguments),this.onCollectionChangedInternal("mode",-1,null)},applyItemStyle:function(){},createChildElement:function(t,e,n,i,o){this.getTemplate("itemTemplate");var r=AtomUI.cloneNode(this._itemTemplate);r._templateParent=this,o?e.insertBefore(r,o):e.appendChild(r);var s=new AtomScope(this,t,t.__application);i&&(s.itemIsFirst=i.isFirst(),s.itemIsLast=i.isLast(),s.itemIndex=i.currentIndex(),s.itemExpanded=!1,s.data=n,s.get_itemSelected=function(){return s.owner.isSelected(n)},s.set_itemSelected=function(){s.owner.toggleSelection(n,!0)});AtomUI.createControl(r,this._childItemType,n,s);return r},toggleSelection:function(t){this._onUIChanged=!0,this._value=void 0,this._allowMultipleSelection?AtomUI.contains(this._selectedItems,t)?AtomBinder.removeItem(this._selectedItems,t):AtomBinder.addItem(this._selectedItems,t):(this._selectedItems.length=1,this._selectedItems[0]=t,AtomBinder.refreshItems(this._selectedItems)),this._onUIChanged=!1},onUpdateUI:function(){e.onUpdateUI.call(this);for(var t=new ChildEnumerator(this._itemsPresenter);t.next();){var n=t.current();if(n.atomControl){var i=n.atomControl.get_data();AtomBinder.refreshValue(n.atomControl.get_scope(),"itemSelected"),this.applyItemStyle(n,i,t.isFirst(),t.isLast())}}},onCreated:function(){this._items&&this.onCollectionChangedInternal("refresh",-1,null);var t=this;this.dispatcher.callLater(function(){t._autoScrollToSelection&&t.bringSelectionIntoView()})},init:function(){this.get_element();this._itemsPresenter||(this._itemsPresenter=this._element);var t=this;this.bindEvent(this._selectedItems,"CollectionChanged",function(){t.onSelectedItemsChanged.apply(t,arguments)}),e.init.apply(this,arguments);var n=this;this.removeItemCommand=function(t,e){if(e){var i=e.get_data();AtomBinder.removeItem(n._items,i)}},this.removeSelectedCommand=function(){for(var t=n.get_selectedItems().slice(0),e=new AtomEnumerator(t);e.next();)AtomBinder.removeItem(n.get_items(),e.current())},this.removeAllCommand=function(){AtomBinder.clear(n.get_items())}}}})}(window,WebAtoms.AtomControl.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomButton",base:e,start:function(t){this._sendData=!1,$(t).addClass("atom-button")},properties:{sendData:!1},methods:{onClickHandler:function(t){return AtomUI.cancelEvent(t),this._next&&(this._sendData&&this._next&&AtomBinder.setValue(this._next,"data",this.get_data()),this.invokeAction(this._next)),!1},init:function(){var t=this._element;this.bindEvent(t,"click","onClickHandler"),e.init.apply(this)}}})}(window,WebAtoms.AtomControl.prototype),function(t,e){var n=t.AtomUI;return classCreatorEx({name:"WebAtoms.AtomDockPanel",base:e,start:function(t){$(t).addClass("atom-dock-panel")},properties:{resizeOnChildResized:!1,contentWidth:0},methods:{resizeChild:function(t){t.atomControl?t.atomControl.updateUI():this.updateChildUI(t)},calculateSize:function(){var t=this.get_element(),e={width:$(t).width(),height:$(t).height()};if(!this._resizeOnChildResized)return e;for(var n=0,i=new ChildEnumerator(t);i.next();){var o=i.current(),r=$(o).attr("atom-dock");switch(r){case"Bottom":case"Fill":case"Top":var s;s=AtomBrowser.isIE&&AtomBrowser.majorVersion<10?o.offsetHeight:$(o).outerHeight(!0),n+=s}}return e.height<n&&(e.height=n,$(t).height(e.height)),e},onUpdateUI:function(){var t=this.get_element(),e=0,i=parseInt($(t).css("paddingTop"),10),o=this.calculateSize(),r=o.height,s=o.width;this._contentWidth&&(e=(s-this._contentWidth)/2,s=this._contentWidth);var a,l,m,u;for(a=new AtomEnumerator($(t).children("[atom-dock='Top']"));a.next();)l=a.current(),m=$(l).outerHeight(!0),n.setItemRect(l,{top:i,left:e,width:s}),i+=m,r-=m,this.resizeChild(l);for(a=new AtomEnumerator($(t).children("[atom-dock='Bottom']").get().reverse());a.next();)l=a.current(),m=$(l).outerHeight(!0),r-=m,n.setItemRect(l,{left:e,top:i+r,width:s}),this.resizeChild(l);for(a=new AtomEnumerator($(t).children("[atom-dock='Left']"));a.next();){l=a.current();var u=$(l).outerWidth(!0);s-=u,n.setItemRect(l,{top:i,left:e,height:r}),e+=u,this.resizeChild(l)}for(a=new AtomEnumerator($(t).children("[atom-dock='Right']").get().reverse());a.next();){l=a.current();var u=$(l).outerWidth(!0);s-=u,n.setItemRect(l,{left:s+e,top:i,height:r}),this.resizeChild(l)}for(a=new AtomEnumerator($(t).children("[atom-dock='Fill']"));a.next();)l=a.current(),u=$(l).css("max-width"),u&&(u=parseFloat(u),u>0&&(s=u)),n.setItemRect(l,{left:e,top:i,width:s,height:r}),this.resizeChild(l)}}})}(window,WebAtoms.AtomControl.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomListBox",base:e,start:function(t){this._labelPath="label",this._valuePath="value",this._autoScrollToSelection=!1,$(t).addClass("atom-list-box")},properties:{autoSelectOnClick:!0},methods:{onClick:function(t){this._autoSelectOnClick&&this.onSelectItem(null,null,t)},get_itemWidth:function(){if(!this._items||!this._items.length)return 0;var t=$(this._element).innerWidth();return t/this._items.length},applyItemStyle:function(t,e,n,i){$(t).removeClass("selected-item list-item first-item last-item"),e&&($(t).addClass("list-item"),n&&$(t).addClass("first-item"),i&&$(t).addClass("last-item"),this.isSelected(e)&&$(t).addClass("selected-item"))},onCreated:function(){this.bindEvent(this._itemsPresenter,"click","onClick"),e.onCreated.call(this)},invokePost:function(){-1!=this.get_selectedIndex()&&e.invokePost.apply(this,arguments)},onSelectItem:function(t,e,n){for(var i=n?n.target:null,o=this._itemsPresenter,r=i||e._element;null!=r.parentNode&&r.parentNode!=o;)r=r.parentNode;if(r!=document){var s=r;this.hasItems()&&(s=r.atomControl.get_data()),this.toggleSelection(s)}},init:function(){e.init.call(this);var t=this;this.selectCommand=function(){t.onSelectItem.apply(t,arguments)},this.selectAllCommand=function(){t.set_selectAll(!0)},this.clearSelectionCommand=function(){t.set_selectedIndex(-1)}}}})}(window,WebAtoms.AtomItemsControl.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomAutoCompleteBox",base:e,start:function(t){$(t).addClass("atom-auto-complete-box"),this._presenters=["itemsPresenter","inputBox","selectionBox"],this._mouseCapture=0},properties:{isPopupOpen:!1,autoOpen:!1,selectedText:"",placeholder:void 0,keyPressed:void 0,displayLabel:void 0},methods:{get_offsetLeft:function(){return $(this._element).offset().left},get_offsetTop:function(){return $(this._element).offset().top},get_offsetWidth:function(){return $(this._inputBox).offset().width},set_itemsUrl:function(t){var e="[ !$owner.keyPressed ? undefined : AtomPromise.json('"+t+"').showProgress(false) ]";this.setValue("items",e,!0,this._element)},set_isPopupOpen:function(e){if(this._isPopupOpen=e,e){AtomBinder.refreshValue(this,"offsetTop"),AtomBinder.refreshValue(this,"offsetLeft"),AtomBinder.refreshValue(this,"offsetWidth");var n=this;this.trySelect(),this.bindEvent(t,"click",function(){n.onWindowClick.apply(n,arguments)})}else this.unbindEvent(t,"click")},onSelectedItemsChanged:function(){this._onUIChanged&&this._selectedItems.length>0&&this.refreshLabel(),e.onSelectedItemsChanged.apply(this,arguments)},onClick:function(){e.onClick.apply(this,arguments),this._backupValue=this.get_value(),this.refreshLabel(),this._backupLabel=this.get_displayLabel(),AtomBinder.setValue(this,"keyPressed",!1),AtomBinder.setValue(this,"isPopupOpen",!1)},restoreSelection:function(){AtomBinder.setValue(this,"isPopupOpen",!1),this._backupValue?(AtomBinder.setValue(this,"value",this._backupValue),AtomBinder.setValue(this,"displayLabel",this._backupLabel),this._backupValue=null):AtomBinder.setValue(this,"selectedIndex",-1)},onKeyUp:function(t){switch(AtomBinder.setValue(this,"isPopupOpen",!0),t.keyCode){case 27:return AtomBinder.setValue(this,"keyPressed",!1),void this.restoreSelection();case 13:return AtomBinder.setValue(this,"keyPressed",!1),AtomBinder.setValue(this,"isPopupOpen",!1),this._backupValue=this.get_value(),this.refreshLabel(),this._backupLabel=this.get_displayLabel(),AtomUI.cancelEvent(t);case 37:break;case 38:return AtomBinder.setValue(this,"keyPressed",!1),void this.moveSelection(!0);case 39:break;case 40:return AtomBinder.setValue(this,"keyPressed",!1),void this.moveSelection(!1);default:var e=this;this.dispatcher.callLater(function(){e.trySelect()})}this.oldTimeout&&clearTimeout(this.oldTimeout);var n=this;this.oldTimeout=setTimeout(function(){AtomBinder.setValue(n,"keyPressed",!0)},500)},trySelect:function(){if(this._items&&0!=this._items.length){var t=new AtomEnumerator(this._items),e=this._labelPath,n=this._displayLabel;for(n&&(n=n.toLowerCase());t.next();){var i=t.current(),o=i;if(e&&(o=o[e]),0==o.toLowerCase().indexOf(n))return AtomBinder.setValue(this,"selectedItem",i),AtomBinder.setValue(this,"selectedText",o),void this.bringSelectionIntoView()}}},moveSelection:function(t){if(this._items&&this._items.length){var e=this.get_selectedIndex();-1==e&&(this.backupLabel=this.get_displayLabel()),e=t?e-1:e+1,t&&-2==e&&(e=this._items.length-1),t||e!=this._items.length||(e=-1),AtomBinder.setValue(this,"selectedIndex",e),-1==e?AtomBinder.setValue(this,"displayLabel",this.backupLabel||""):this.refreshLabel()}},refreshLabel:function(){var t=this.get_selectedItem(),e=t;e&&this._labelPath&&(e=e[this._labelPath]),AtomBinder.setValue(this,"displayLabel",e||"")},onWindowClick:function(t){for(var e=this._element,n=this._itemsPresenter,i=t.target;null!=i.parentNode&&i!=e&&i!=n;)i=i.parentNode;i!=e&&i!=n&&this.restoreSelection()},onInputFocus:function(){this._autoOpen&&(this._backupValue=this.get_value(),this._backupLabel=this.get_displayLabel(),AtomBinder.setValue(this,"isPopupOpen",!0),$(this._inputBox).select())},onInputBlur:function(){if(!this._mouseCapture){var t=this;setTimeout(function(){t._isPopupOpen&&(AtomBinder.setValue(t,"isPopupOpen",!1),t.restoreSelection())},10)}},onCreated:function(){this._itemsPresenter._logicalParent=this._element,$(this._itemsPresenter).remove(),document.body.appendChild(this._itemsPresenter),$(this._itemsPresenter).addClass("atom-auto-complete-popup"),e.onCreated.apply(this,arguments),this.bindEvent(this._itemsPresenter,"mouseover","onMouseOver"),this.bindEvent(this._itemsPresenter,"mouseout","onMouseOut")},onMouseOver:function(){this._mouseCapture++},onMouseOut:function(){var t=this;setTimeout(function(){t._mouseCapture--},1e3)},init:function(){e.init.apply(this,arguments),this.bindEvent(this._inputBox,"focus","onInputFocus"),this.bindEvent(this._inputBox,"blur","onInputBlur"),this.bindEvent(this._inputBox,"keyup","onKeyUp")},dispose:function(){this._itemsPresenter&&(this.disposeChildren(this._itemsPresenter),$(this._itemsPresenter).remove(),this._itemsPresenter=null),e.dispose.call(this)}}})}(window,WebAtoms.AtomListBox.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomCheckBoxList",base:e,start:function(){this._allowMultipleSelection=!0,this._valueSeparator=", ",this._dataElements=[]},methods:{init:function(){e.init.call(this),$(this._element).addClass("atom-check-box-list")}}})}(window,WebAtoms.AtomItemsControl.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomComboBox",base:e,start:function(){this._labelPath="label",this._valuePath="value",this._allowSelectFirst=!0},methods:{invokePost:function(){this.get_selectedIndex()>0&&e.invokePost.apply(this,arguments)},invokeNext:function(){e.invokeNext.apply(this,arguments),this._postUrl&&(AtomBinder.setValue(this,"selectedIndex",0),this.updateChildSelections())},onSelectionChanged:function(){this._onUIChanged=!0;var t=this.get_element();this.set_selectedIndex(t.selectedIndex),this._onUIChanged=!1},updateChildSelections:function(){var t=this._element;t.selectedIndex=this.get_selectedIndex()},onCollectionChanged:function(){var t=this.get_element(),e=this.get_dataItems();t.options.length=e.length;for(var n=new AtomEnumerator(e),i=this._labelPath,o=this._valuePath,r=null,s=null,a=this.get_value();n.next();){var l=n.current();r=l,s=l,i&&(r=r[i]),o&&(s=s[o]),t.options[n.currentIndex()]=new Option(r,s,!1,s==a)}},verifyTemplates:function(){},init:function(){var t=this.get_element();this.bindEvent(t,"change","onSelectionChanged"),e.init.apply(this,arguments)}}})}(window,WebAtoms.AtomItemsControl.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomDateListBox",base:e,start:function(){this._monthList=AtomDate.monthList;var t=new Date;this._month=t.getMonth()+1,this._year=t.getFullYear(),this._selectedItems=[],this._presenters=["itemsPresenter"],this._startYear=-5,this._endYear=10,this._currentYear=(new Date).getFullYear(),this._value=null},properties:{month:0,year:0,selectedItems:[],startYear:-5,endYear:0,currentYear:0,monthList:null,items:void 0,month:null,visibleDate:void 0},methods:{set_month:function(t){this._month=t,this.updateList()},set_year:function(t){this._year=t,this.updateList()},set_visibleDate:function(t){t&&(this._visibleDate=t,this._year=t.getFullYear(),this._month=t.getMonth()+1,this.updateList(),AtomBinder.refreshValue(this,"year"),AtomBinder.refreshValue(this,"month"))},init:function(){e.init.apply(this);var t=this;this.toggleDateCommand=function(){t.toggleDate.apply(t,arguments)}},onLoaded:function(){var t=this.getTemplate("itemTemplate"),e=this.get_scope(),n=this._itemsPresenter,i=this.getTemplate("itemTemplate");if(i&&(i=$(i).attr("atom-type"),i||(i=WebAtoms.AtomControl)),this.updateList(),t)for(var o=this._items,r=0;42>r;r++){var s=AtomUI.cloneNode(t);s._templateParent=this;var a=new AtomScope(this,e,atomApplication);a.itemIndex=r,$(n).append(s);{AtomUI.createControl(s,i,o[r],a)}}},toggleDate:function(t,e){var n=e.get_data(),i=$.inArray(n.value,$.map(this._selectedItems,function(t){return t.value}));i>-1?AtomBinder.removeAtIndex(this._selectedItems,i):AtomBinder.addItem(this._selectedItems,n),AtomBinder.refreshValue(this,"value"),AtomBinder.refreshValue(this,"selectedItems"),this.invokeAction(this._next)},getItemClass:function(t){var e=$.inArray(t.value,$.map(this._selectedItems,function(t){return t.value}))>-1,n=t.date.getDay(),i=0==n||6==n,o="atom-date-list-box-day-list-item ";return o+=i?"atom-date-list-box-weekend ":"",o+=e?"atom-date-list-box-selected ":"atom-date-list-box-item ",o+=this._month==t.date.getMonth()+1?"":"atom-date-list-box-day-list-item-other"},set_value:function(t){if(void 0!==t){if(this._selectedItems.length=0,null!==t)for(var e=t.split(","),n=0;n<e.length;n++){var i=e[n];if(i){var o=i.split("/"),r=new Date(parseInt(o[2],10),parseInt(o[0],10)-1,parseInt(o[1],10));this._selectedItems.push({date:r,dateLabel:AtomDate.toShortDateString(r),value:i,label:r.getDate()})}}this._created&&(AtomBinder.refreshItems(this._selectedItems),AtomBinder.refreshValue(this,"value"),AtomBinder.refreshValue(this,"selectedItems"))}},get_value:function(){return $.map(this._selectedItems,function(t){return t.value}).join(",")},updateList:function(){if(this._month&&this._year){var t=new Date,e=(new Date(this._year,this._month-1,1),new Date(this._year,this._month-1,1));if(e.getDay()){var n=e.getDay()-1;n=-n,e.setDate(n)}var i=e.getMonth(),o=e.getFullYear(),r=[],s=0,a=this._month-1;for(s=0;42>s;s++){var l=s+e.getDate(),m=new Date(o,i,l),u=m.getDay();u=0==u||6==u,r.push({label:m.getDate(),isWeekEnd:u,isToday:t.getDate()==m.getDate()&&t.getMonth()==m.getMonth()&&t.getFullYear()==m.getFullYear(),isOtherMonth:m.getMonth()!=a,dateLabel:AtomDate.toShortDateString(m),value:AtomDate.toMMDDYY(m),date:m})}this._items=r,AtomBinder.refreshValue(this,"items"),AtomBinder.refreshValue(this,"selectedItems"),this._created&&AtomBinder.refreshValue(this,"value")}}}})}(window,WebAtoms.AtomControl.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomPostButton",base:e,start:function(){},properties:{postData:null,postResult:null,postUrl:null,next:null,confirm:!1,confirmMessage:null,mergeData:null},methods:{get_postData:function(){return this._postData||this.get_data()},onClickHandler:function(t){if(this._confirm){var e=this;return void Atom.confirm(this._confirmMessage,function(){e.onConfirmed(t)})}this.onConfirmed(t)},onConfirmed:function(){if(!this._postUrl)return void e.onClickHandler.apply(this,arguments);var t=this.get_postData();if(null!==t&&void 0!==t){var n=this._mergeData;if(n)for(var i in n)t[i]=n[i];var o=this,r=function(t){AtomBinder.setValue(o,"postResult",t.value()),o.invokeAction(o._next)};AtomPromise.json(this._postUrl,null,{type:"POST",data:t}).then(r).invoke()}}}})}(window,WebAtoms.AtomButton.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomToggleButtonBar",base:e,start:function(t){this._allowSelectFirst=!0,this._allowMultipleSelection=!1,this._showTabs=!1,this._autoScrollToSelection=!1,$(t).removeClass("atom-list-box")},properties:{showTabs:!1},methods:{init:function(){e.init.call(this),this.setValue("class","[$owner.showTabs ? 'atom-tab-button-bar' : 'atom-toggle-button-bar']",!0,this._element)}}})}(window,WebAtoms.AtomListBox.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomViewStack",base:e,start:function(){this._swipeDirection="left-right"},properties:{selectedIndex:-1,previousIndex:-1,swipeDirection:"left-right"},methods:{bringSelectionIntoView:function(){},set_swipeDirection:function(t){var e=this._swipeDirection;e&&$(this._element).removeClass(e),this._swipeDirection=t,t&&$(this._element).addClass(t)},set_selectedIndex:function(t){if(this._isAnimating){var e=this;return void setTimeout(function(){e.set_selectedIndex(t)},50)}this._previousIndex=this._selectedIndex,this._selectedIndex=t,this.updateUI()},get_selectedChild:function(){return this._selectedChild},onUpdateUI:function(){var t=this._element,e=new ChildEnumerator(t),n=this.get_selectedIndex(),i=this._previousIndex,o=new WebAtoms.AtomDispatcher;o.pause();for(var r,s,a=-1,l=this;e.next();){a+=1;var m=e.current();$(m).addClass("view-stack-child"),-1==i&&$(m).addClass("hidden"),a==n?r=m:a==i?s=m:$(m).addClass("hidden")}if(r){var u=$(t).innerWidth(),h=$(t).innerHeight();this._selectedChild=r,AtomUI.setItemRect(r,{width:u,height:h});var d=r.atomControl;if(d&&d.updateUI(),s){var l=this;this._isAnimating=!0;var c=[r,s];$(c).removeClass("hidden"),i>n?$(r).css("left",-u):$(r).css("left",u),$(c).addClass("animate-left-property"),WebAtoms.dispatcher.callLater(function(){$(r).css("left",0),i>n?$(s).css("left",u):$(s).css("left",-u),setTimeout(function(){l._isAnimating=!1,$(c).removeClass("animate-left-property"),$(s).addClass("hidden")},600)})}else $(r).removeClass("hidden")}o.start()},init:function(){var t=this.get_element();$(t).addClass("atom-view-stack"),e.init.call(this);var t=this.get_element();t.parentNode.atomControl||$(t).addClass("atom-view-stack-fill"),$(t).addClass(this._swipeDirection)}}})}(window,WebAtoms.AtomControl.prototype),this.appScope=null,this.atomApplication=null,function(t,e,n){return classCreator(e,n,function(e){if($(e).removeClass("atom-dock-panel"),$(e).addClass("atom-application"),this._scope=new AtomScope(this,null,this),t.appScope=this._scope,t.model&&(t.appScope.model=t.model,this._data=t.model),t.atomApplication=this,location.hash){var n=location.hash.substring(1);this._urlScope=AtomUI.parseUrl(n)}else this._urlScope={};this.onHashChanged(),this.busyCount=0},{get_title:function(){return t.document.title},set_title:function(e){t.document.title=e},get_isBusy:function(){return this.busyCount},setBusy:function(t,e){t?this.busyCount++:this.busyCount--,void 0!==e?(e||(e=""),AtomBinder.setValue(this,"busyMessage",e)):AtomBinder.setValue(this,"busyMessage","Loading..."),AtomBinder.refreshValue(this,"isBusy")},updateUI:function(){n.updateUI.call(this),AtomBinder.refreshValue(this,"appWidth"),AtomBinder.refreshValue(this,"appHeight"),AtomBinder.refreshValue(this,"bodyWidth"),AtomBinder.refreshValue(this,"bodyHeight")},onUpdateUI:function(){this._renderAsPage||n.onUpdateUI.call(this)},get_appWidth:function(){return $(this._element).width()},get_appHeight:function(){return $(this._element).height()},get_bodyWidth:function(){return $(document.body).width()},get_bodyHeight:function(){return $(document.body).height()},onHashChanged:function(){if(!this._noHashRefresh){var t=this._scope,e=location.hash?location.hash:this._defaultScope;if(e){this._noHashRefresh=!0,e=e.substr(1);var n=AtomUI.parseUrl(e);if(this._created)for(var i in n){var o=n[i];t[i]!=o&&AtomBinder.setValue(t,i,o)}else Atom.merge(t,n);this._noHashRefresh=!1}}},invokeUpdateUI:function(){var e=this;t.setTimeout(function(){return e.updateUI()},5)},onRefreshValue:function(t,e){if(!this._noHashRefresh){var n=e;if(0!=n.indexOf("_")){var i=this._scope[n];if(void 0!==i&&null!==i){var o=typeof i;if("string"==o||"number"==o||"boolean"==o){var r={},s=this._scope,a=this._defaultScopeValues||{};for(var l in s){var m=s[l];(this._urlScope[l]||m!=a[l])&&(r[l]=m)}var u=Atom.encodeParameters(r);if(!u)return void(history&&history.pushState?history.pushState({},document.title,location.href.split("#")[0]):location.hash="");u="#"+u,location.hash!=u&&(this._noHashRefresh=!0,history&&history.pushState?history.pushState({},document.title,location.href.split("#")[0]+u):location.href=u,this._noHashRefresh=!1)}}}}},onInitialized:function(){var t={},e=this._scope;for(var i in e)if(0!=i.indexOf("_")){var o=e[i];if(void 0!==o&&null!==o){var r=typeof o;("string"==r||"number"==r||"boolean"==r)&&(t[i]=o)}}this._defaultScopeValues=t;var s=Atom.encodeParameters(this._scope);s&&(this._defaultScope="#"+s),n.onInitialized.call(this)},createChildren:function(){n.createChildren.call(this),this.getTemplate("busyTemplate"),this._busyTemplate&&(this._element.appendChild(this._busyTemplate),this.onCreateChildren(this._busyTemplate))},onCreated:function(){if(n.onCreated.call(this),AtomBrowser.isIE&&AtomBrowser.majorVersion<8){var e=this;setInterval(function(){e.onCheckHash()},1e3),this._lastHash=location.hash}else{var i=t.onhashchange?"onhashchange":"hashchange";this.bindEvent(t,i,"onHashChanged")}this._next&&WebAtoms.dispatcher.callLater(function(){t.atomApplication.invokeAction(t.atomApplication._next)})},onCheckHash:function(){this._lastHash!=location.hash&&(this.onHashChanged(),this._lastHash=location.hash)},onCloseCommand:function(){if(parent){var t=frameElement.atomWindow;t._value=this._value,t.onCloseCommand()}},setup:function(){this.createChildren(),this.init()},onInitialized:function(){n.onInitialized.apply(this,arguments),this._renderAsPage||$(this._element).addClass("atom-dock-application")},init:function(){this.bindEvent(t,"resize","invokeUpdateUI");
var e=this;this._onRefreshValue=function(){e.onRefreshValue.apply(e,arguments)},this._scope._$_watcher=this,n.init.call(this),this.closeCommand=function(){e.onCloseCommand.apply(e,arguments)}}},{renderAsPage:!1,busyMessage:"",progress:0})}(window,"WebAtoms.AtomApplication",WebAtoms.AtomDockPanel.prototype),function(baseType){return classCreatorEx({name:"WebAtoms.AtomForm",base:baseType,start:function(){this._success=null,this._submit=null,this._error=null,this._attachments=null},properties:{result:null,mergeData:null,mergeResult:!0,postUrl:null,postData:null,successMessage:null,clearData:!1},methods:{createFormLayout:function(){},preparePostData:function(){var t=(this.get_element(),this._postData||this.get_data()),e=this._mergeData;if(e)for(var n in e)t[n]=e[n];return t},onSubmit:function(){if(this.isValid()){var t=this.preparePostData(),e=AtomPromise.getUrl(this._postUrl);AtomPromise.json(e,{_tv:Atom.time()},{type:"POST",data:t}).then(this._success).invoke()}},onSuccess:function(t){var e=t.value();if(AtomBinder.setValue(this,"result",e),this._mergeResult){var n=this.get_data();for(var i in e)AtomBinder.setValue(n,i,e[i])}if(this._clearData){var n=this.get_data();for(var i in this._clearData)AtomBinder.setValue(n,i,e[i])}this._successMessage&&Atom.alert(this._successMessage),this.invokeAction(this._next)},onKeyUp:function(t){if(!(t.target&&t.target.nodeName&&/textarea/gi.test(t.target.nodeName))&&13==t.keyCode){var e=this;/input/gi.test(t.target.nodeName)&&$(t.target).change(),WebAtoms.dispatcher.callLater(function(){e.onSubmit()})}},isValid:function(){for(var t=this.get_element(),e=new ChildEnumerator(t),n=!0;e.next();){var i=e.current();this.validate(i)||(n=!1)}return n},validateField:function(t){var e=t.target;this.validate(e)},validate:function(e,ef){ef||(ef=$(e).data("field-error"));var ctrl=e.atomControl,val=null,skip=!1;if(ctrl){if(ctrl.constructor==WebAtoms.AtomFormField)return ctrl.validate();val=AtomBinder.getValue(ctrl,"value")}else/input|select|textarea/i.test(e.nodeName)?val=$(e).val():skip=!0;if(!skip){var req=$(e).attr("atom-required");if(req&&!val)return $(ef).text("Required"),$(e).addClass("atom-data-error"),!1;var re=$(e).attr("atom-regex");if(re)re=eval("("+re+")");else{var dt=$(e).attr("atom-data-type");if(dt)switch(dt){case"email":re=/^(([^<>()\[\]\\.,;:\s@\"]+(\.[^<>()\[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/}}if(re&&!re.test(val))return $(ef).text("Invalid"),$(e).addClass("atom-data-error"),!1;$(ef).text(""),$(e).removeClass("atom-data-error")}for(var ae=new ChildEnumerator(e),isValid=!0;ae.next();)this.validate(ae.current(),ef)||(isValid=!1);return isValid},init:function(){baseType.init.call(this);var t=this;this._success=function(){t.onSuccess.apply(t,arguments)},this._submit=function(){t.onSubmit.apply(t,arguments)};var e=this.get_element();this.submitCommand=this._submit,this.bindEvent(e,"keyup","onKeyUp"),$(e).find("input[type=submit]").bind("click",null,this._submit),$(e).find("button[type=submit]").bind("click",null,this._submit);var t=this;this._vh=function(){t.validateField.apply(t,arguments)},$(e).find("input,select,textarea").bind("blur",null,this._vh)}}})}(WebAtoms.AtomControl.prototype),function(t){return classCreatorEx({name:"WebAtoms.AtomFormLayout",base:t,start:function(){this._useTable=!0,this._errorItems=[],this._minLabelWidth=0},properties:{minLabelWidth:0},methods:{createField:function(t,e){var n=AtomUI.attributeMap(e,/^(atom\-(type|label|required|regex|data\-type|is\-valid|field\-(value|visible|class)|error))$/i),i=n["atom-type"];if(i)switch(n["atom-type"]=null,i.value){case"AtomFormGridLayout":case"AtomFormTab":t.appendChild(e);var o=AtomUI.createControl(e,i.value);return o}var r=AtomUI.cloneNode(this._fieldTemplate),s=AtomUI.findPresenter(r);s?(s.appendChild(e),$(s).removeAttr("atom-presenter")):r.contentElement=e,t.appendChild(r);for(var a in n){var l=n[a];l&&(e.removeAttributeNode(l.node),r.setAttributeNode(l.node))}if(n=AtomUI.attributeMap(r,/^atom\-(field\-value|is\-valid)$/i),!n["atom-field-value"]&&!n["atom-is-valid"]){var l=$(e).attr("atom-value");if(l&&/^\$\[/gi.test(l)){l=l.substr(2),/^\$/gi.test(l)||(l="$"+l),l="["+l;var m=l.indexOf("]");l=l.substr(0,m+1),$(r).attr("atom-field-value",l)}}return AtomUI.createControl(r,WebAtoms.AtomFieldType)},createChildren:function(){var t=this._element;$(t).addClass("atom-form");var e=new AtomEnumerator($(t).children()),n=document.createElement("TABLE");$(n).addClass("atom-form-table");var i=document.createElement("TBODY");AtomUI.removeAllChildren(t),t.appendChild(n),n.appendChild(i);var o;for(this.getTemplate("fieldTemplate");e.next();)o=e.current(),o&&this.createField(i,o)}}})}(WebAtoms.AtomControl.prototype),function(){return classCreatorEx({name:"WebAtoms.AtomLayout",start:function(){},methods:{doLayout:function(){}}})}(),function(t){return classCreatorEx({name:"WebAtoms.AtomWindow",base:t,start:function(){this._presenters=["windowDiv","windowTitleDiv","windowCloseButton","iframe","windowPlaceholder"]},properties:{opener:null,openerData:null,windowTemplate:null,isOpen:!1,windowHeight:300,windowWidth:500,url:void 0,title:void 0},methods:{get_openerData:function(){var t=this.get_opener();if(t)return t.get_data()},onCloseCommand:function(){AtomBinder.setValue(this,"isOpen",!1);var t=this._value,e=this;this._value=null,this.disposeChildren(this._element),setTimeout(function(){AtomBinder.setValue(e,"value",t),e.invokeAction(e._next)},1)},refresh:function(t,e){this.openWindow(t,e)},openWindow:function(t,e){var n=this.getTemplate("frameTemplate");n=AtomUI.cloneNode(n);var i=$(n).find("[atom-presenter=windowDiv]").get(0),o=($(n).find("[atom-presenter=windowTitleDiv]").get(0),this.getTemplate("windowTemplate"));if($(o).addClass("atom-window-template"),$(o).attr("atom-dock")||$(o).attr("atom-dock","Fill"),o.length)for(var r=0;r<o.length;r++)i.appendChild(o[r]);else i.appendChild(o);var s=this.getTemplate("commandTemplate");s&&(s.setAttribute("atom-dock","Bottom"),s.setAttribute("class","atom-wizard-command-bar"),i.appendChild(s)),this.set_innerTemplate(n),this._iframe&&(this._iframe.atomWindow=this),e&&(this._opener=e,AtomBinder.refreshValue(this,"opener"),AtomBinder.refreshValue(this,"openerData"));var a=this;WebAtoms.dispatcher.callLater(function(){if(AtomBinder.setValue(a,"isOpen",!0),!a._url){var t=$(a._windowPlaceholder).find("input");if(t.length>0){var e=t.get(0);try{e.focus()}catch(n){}}}})},init:function(){$(this._element).addClass("atom-window-placeholder"),t.init.call(this);var e=this;this.closeCommand=function(){e.onCloseCommand.apply(e,arguments)},this.openCommand=function(){e.openWindow.apply(e,arguments)},WebAtoms.dispatcher.callLater(function(){e._element._logicalParent=e._element.parentNode,$(e._element).remove(),document.body.appendChild(e._element)})}}})}(WebAtoms.AtomControl.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomCalendar",start:function(){},properties:{currentMonth:(new Date).getMonth()+1,currentYear:(new Date).getFullYear(),startDate:null,endDate:null},methods:{set_currentMonth:function(t){this._currentMonth=t,this.updateCalendar()},set_currentYear:function(t){this._currentYear=t,this.updateCalendar()},onCreated:function(){e.onCreated.call(this),this.updateCalendar()},applyItemStyle:function(t,e){$(t).removeClass("other weekend today"),$(t).addClass("calendar-item"),e.IsOtherMonth&&$(t).addClass("other"),e.IsWeekEnd&&$(t).addClass("weekend"),e.IsToday&&$(t).addClass("today")},updateCalendar:function(){if(this._created){for(var t=this._currentYear,e=this._currentMonth-1,n=new Date(t,e,1);n.getDay()>0;){var i=new Date(n.getTime());i.setDate(n.getDate()-1),n=i}var o=[],r=new Date(n.getTime());r.setDate(r.getDate()+42);for(var s=n;s.getTime()<r.getTime();){var i=new Date(s.getTime());i.setDate(s.getDate()+1),o.push({value:s,label:s.getDate(),next:i,IsOtherMonth:s.getMonth()!=e,IsWeekEnd:0==s.getDay()||6==s.getDay(),IsToday:s.getDate()==now.getDate()&&s.getMonth()==now.getMonth()}),s=i}AtomBinder.setValue(this,"items",o),AtomBinder.setValue(this,"startDate",n),AtomBinder.setValue(this,"endDate",r)}},changeMonth:function(t){var e=this._currentMonth;e+=t,e>12&&(e=1,this._currentYear+=1),0==e&&(this._currentYear-=1,e=12),AtomBinder.setValue(this,"currentMonth",e)},init:function(){e.init.call(this);var t=this;this.nextMonthCommand=function(){t.changeMonth(1)},this.prevMonthCommand=function(){t.changeMonth(-1)}}}})}(window,WebAtoms.AtomListBox.prototype),function(t,e,n){return classCreatorEx({name:e,base:n,properties:{itemsPath:"items",totalPath:"total",pageSize:25,currentPage:0,items:null,total:0,pages:[]},start:function(){this._presenters=["pageList"];var t=this,e=AtomBinder;this.goFirstCommand=function(){e.setValue(t,"currentPage",0)},this.goLastCommand=function(){e.setValue(t,"currentPage",t._pages.length-1)},this.goNextCommand=function(){e.setValue(t,"currentPage",t.get_currentPage()+1)},this.goPrevCommand=function(){e.setValue(t,"currentPage",t.get_currentPage()-1)}},methods:{preparePages:function(){if(this._items&&this._total){var t=(this._items.length,this._total),e=Math.ceil(t/this._pageSize);if(e!=this._pages.length){var n,i=(this._pageSize,[]);for(n=0;e>n;n++)i.push({value:n,label:n+1});AtomBinder.setValue(this,"pages",i)}}},set_items:function(t){t!=this._items&&this._items&&this.unbindEvent(this._items,"CollectionChanged","onCollectionChangedInternal"),t&&(this._items=t,null!=t&&this._created&&(this.bindEvent(this._items,"CollectionChanged","onCollectionChangedInternal"),this.onCollectionChangedInternal("refresh",-1,null)))},onCollectionChangedInternal:function(){var t=this._items;if(void 0===t.length){var e=t[this._itemsPath];AtomBinder.setValue(this,"total",t[this._totalPath]),AtomBinder.setValue(this,"value",e)}else t.total?AtomBinder.setValue(this,"total",t.total):AtomBinder.setValue(this,"pages",[]),AtomBinder.setValue(this,"value",t);this.preparePages()},onCreated:function(){this._items&&(this.bindEvent(this._items,"CollectionChanged","onCollectionChangedInternal"),this.onCollectionChangedInternal("refresh",-1,null))},set_currentPage:function(t){this._currentPage=t,AtomBinder.refreshValue(this,"pageStart")},get_pageStart:function(){return this._currentPage*this._pageSize},set_pageSize:function(t){this._pageSize=t,this.preparePages()},set_total:function(t){this._total!=t&&(this._total=t)},init:function(){$(this._element).addClass("atom-data-pager"),n.init.apply(this,arguments)}}})}(window,"WebAtoms.AtomDataPager",WebAtoms.AtomControl.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomDateControl",base:e,start:function(){},properties:{startYear:-1,endYear:10},methods:{resetYears:function(){var t=this._year,e=new Date,n=e.getFullYear();n+=this._startYear;var i=e.getFullYear()+this._endYear,o=this._value;o||(o=e),t.options.length=0;var r=1;t.options[0]=new Option("Select","",!1,!1);for(var e=(this._value||new Date).getFullYear(),s=n;i>=s;s++)t.options[r]=new Option(s,s,!1,e==s),r++},set_value:function(t){t&&t.constructor==String&&(t=new Date(parseInt(t.substr(6)))),this._value=t,this.setDate()},setDate:function(){if(this._value){var t=this._value,e=t.getMonth()+1,n=t.getDate(),i=t.getFullYear();this.setComboValue(this._month,e),this.setComboValue(this._year,i),this.setComboValue(this._date,n)}},setComboValue:function(t,e){for(var n=new AtomEnumerator(t.options);n.next();)if(n.current().value==e){t.selectedIndex=n.currentIndex();break}},set_startYear:function(t){this._startYear=t,this.resetYears()},set_endYear:function(t){this._endYear=t,this.resetYears()},onDataChange:function(){var t=$(this._year).val(),e=$(this._month).val(),n=$(this._date).val();try{if(t&&e&&n){var i=new Date(t,e-1,n,9,0,0);this._value=i}else this._value=null}catch(o){Atom.alert(o)}AtomBinder.refreshValue(this,"value")},setMonths:function(){var t=AtomDate.monthList,e=this._month.options;e.length=0;var n=new AtomEnumerator(t);for(e[0]=new Option("Select","",!1,!1);n.next();){var i=n.current();e[n.currentIndex()+1]=new Option(i.label,i.value,!1,!1)}this.setDate(),AtomBinder.refreshValue(this,"value")},init:function(){var t=this._element;this._date=document.createElement("SELECT"),this._month=document.createElement("SELECT"),this._year=document.createElement("SELECT"),t.style.height="25px",t.appendChild(this._date),t.appendChild(this._month),t.appendChild(this._year);var n,i=this._date.options;for(i[0]=new Option("Select","",!1,!1),n=1;32>n;n++)i[n]=new Option(n,n,!1,!1);this.resetYears(),this.bindEvent(this._date,"change","onDataChange"),this.bindEvent(this._month,"change","onDataChange"),this.bindEvent(this._year,"change","onDataChange"),this.setMonths(),e.init.apply(this,arguments)}}})}(window,WebAtoms.AtomControl.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomDateField",base:e,start:function(t){this._presenters=["calendarPresenter","itemsPresenter"],$(t).addClass("atom-date-field")},properties:{isOpen:!1,time:"9:00 AM"},methods:{get_offsetLeft:function(){return $(this._element).offset().left},get_offsetTop:function(){return $(this._element).offset().top},onPopupRemoved:function(){AtomBinder.setValue(this,"isOpen",!1)},set_isOpen:function(t){if(this._isOpen=t,t){this.getTemplate("popupTemplate"),this.popup=AtomUI.cloneNode(this._popupTemplate),this.popup._logicalParent=this._element,this.popup._templateParent=this,document.body.appendChild(this.popup),this.onCreateChildren(this.popup),this.setProperties(this.popup),this.initChildren(this.popup);var e=this;this._refreshInterval=setInterval(function(){AtomBinder.refreshValue(e,"offsetLeft"),AtomBinder.refreshValue(e,"offsetTop")})}else this._refreshInterval&&clearInterval(this._refreshInterval),this.popup&&(this.disposeChildren(this.popup),$(this.popup).remove(),this.popup=null)},dispose:function(){this.set_isOpen(!1),e.dispose.call(this)},get_isOpen:function(){return this._isOpen},get_selectedItem:function(){return this._selectedItems.length?this._selectedItems[0]:null},set_time:function(t){if(!this._set_timeCalled){if(this._set_timeCalled=!0,t){this._time=t;var e=AtomDate.setTime(this.get_value(),t);AtomBinder.setValue(this,"value",e)}this._set_timeCalled=!1}},set_value:function(t){t=AtomDate.parse(t),this._value=t,AtomBinder.setValue(this,"time",AtomDate.toTimeString(t)),this._selectedItems.length=0,t&&(this._selectedItems.push({date:t,dateLabel:AtomDate.toShortDateString(t),value:AtomDate.toMMDDYY(t),label:t.getDate()}),this.set_visibleDate(t)),this._created&&(AtomBinder.refreshItems(this._selectedItems),AtomBinder.refreshValue(this,"value"),AtomBinder.refreshValue(this,"selectedItem"),AtomBinder.refreshValue(this,"selectedItems"))},get_value:function(){return this._selectedItems.length?this._selectedItems[0].date:this._value},toggleDate:function(t,e){var n=e.get_data();this._selectedItems.length=0,AtomBinder.addItem(this._selectedItems,n),AtomBinder.refreshValue(this,"value"),AtomBinder.refreshValue(this,"selectedItem"),AtomBinder.refreshValue(this,"selectedItems"),AtomBinder.setValue(this,"isOpen",!1)}}})}(window,WebAtoms.AtomDateListBox.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomDeleteButton",base:e,start:function(){this._confirm=!0,this._confirmMessage="Are you sure you want to delete this item?"},methods:{},properties:{}})}(window,WebAtoms.AtomPostButton.prototype),function(t,e){return createClass({name:"WebAtoms.AtomFrameView",base:e,start:function(t){var e=this;$(t).addClass("atom-frame-view"),this._items=[],this._layout=WebAtoms.AtomViewBoxLayout.defaultInstance,this.backCommand=function(){e.onBackCommand.apply(e,arguments)}},properties:{url:"",layout:null,items:[],removeOnBack:!0},methods:{set_url:function(t){if(t){var e=t.indexOf("?"),n=t,i="";-1!==e&&(n=t.substr(0,e),i=t.substr(e+1));var o=this._items,r=Atom.query(o).firstOrDefault({url:n});if(!r){var s=Atom.get(this,"scope"),a=s[n];if(!a)return void(console&&console.error&&console.error("Page Template "+a+" not found"));a=AtomUI.cloneNode(a),r={url:n,index:o.length,element:a},Atom.add(o,r),this._element.appendChild(a);var l=AtomUI.createControl(a,$(a).attr("atom-type")||WebAtoms.AtomControl);r.control=l,WebAtoms.dispatcher.callLater(function(){l.init()})}Atom.set(this,"selectedIndex",r.index),i&&WebAtoms.dispatcher.callLater(function(){location.hash=i}),this._url=t}},onBackCommand:function(){var t=this._selectedIndex;if(t){var e=Atom.query(this._items).firstOrDefault({index:t});if(e){var n=this;t-=1,Atom.set(this,"selectedIndex",t),n._removeOnBack&&setTimeout(function(){e.control.dispose(),$(e.element).remove(),Atom.remove(n._items,e);for(var i=Atom.query(n._items),o=0;i.next();){var r=i.current();r.index=o++,i.currentIndex()==t&&(n._url=r.url,Atom.refresh(n,"url"))}},1e3)}}},init:function(){e.init.call(this);var t=this,n=this._url;n&&WebAtoms.dispatcher.callLater(function(){t.set_url(n)})}}})}(window,WebAtoms.AtomViewStack.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomLinkBar",base:e,start:function(){this._allowSelectFirst=!1;var t=this;this.openMenuCommand=function(){t.openMenu.apply(t,arguments)}},properties:{itemsPath:"items",selectCurrent:!0,targetPath:"",menuTemplate:null,menuDirection:"horizontal"},methods:{onClick:function(){},openMenu:function(t){var e=t.target,n=this.get_atomParent(e);if(null!=n){var i=n.get_data();if(i[this._itemsPath]){var o=this._subMenu;if(o)AtomPopup.hide(o._element);else{var r=this.getTemplate("menuTemplate");o=AtomUI.cloneNode(r),o._templateParent=this,o.style.position="absolute",document.body.appendChild(o);var r=$(o).attr("atom-type")||WebAtoms.AtomControl;o=AtomUI.createControl(o,r,i),this._subMenu=o}AtomBinder.setValue(o,"data",i),AtomPopup.show(n._element,o._element,0),AtomUI.cancelEvent(t)}}},selectDefault:function(){this._items&&this._selectCurrent&&(this._value||(AtomBinder.setValue(this,"value",location.pathname),-1==this.get_selectedIndex()&&this.selectItem(this._items),this.updateSelectionBindings()))},selectItem:function(t,e){for(var n=new AtomEnumerator(t),i=this._valuePath,o=location.pathname.toLowerCase();n.next();){var r=n.current(),s=r;if(i&&(s=s[i]),s){if(o==s.toLowerCase())return e||AtomBinder.setValue(this,"selectedItem",r),!0;if(r.links&&this.selectItem(r.links,!0))return AtomBinder.setValue(this,"selectedItem",r),!0}}return!1},dispose:function(){this._subMenu&&(this._subMenu.dispose(),this._subMenu=null),e.dispose.apply(this,arguments)},init:function(){e.init.apply(this,arguments),this.bindEvent(this._element,"click","openMenuCommand"),this.setValue("class","[$owner.showTabs ? 'atom-tab-button-bar' : 'atom-link-bar']",!0,this._element)}}})}(window,WebAtoms.AtomToggleButtonBar.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomMultiButtonList",base:e,start:function(){this._dataElements=[]},properties:{labelPath:"label",valuePath:"value",options:null,isRadio:!1,items:null},methods:{set_options:function(t){this._options=t,t&&this.onCollectionChangedInternal("refresh",-1,null)},set_value:function(t){this._value=t,this.updateSelections()},set_items:function(t){this._items&&this.unbindEvent(this._items,"CollectionChanged","onCollectionChangedInternal"),this._items=t,null!=t&&(this.bindEvent(this._items,"CollectionChanged","onCollectionChangedInternal"),this.onCollectionChangedInternal("refresh",-1,null))},onCollectionChangedInternal:function(t,e,n){var i=this.get_value();this.onCollectionChanged(t,e,n),this.set_value(i)},onCollectionChanged:function(){if(this._items&&this._options){this._dataElements=[],this.unbindEvent(null,"change","onDataChange");for(var t=new AtomEnumerator(this._items),e=this.get_scope();t.next();){var n=t.current();this.createChildElement(e,this._element,n)}this.updateUI()}},updateSelections:function(){if(this._dataElements&&0!=this._dataElements.length){for(e=new AtomEnumerator(this._dataElements);e.next();)$(e.current()).attr("checked",!1);if(this._value){var t,e,n,i=this._value.split(",");e.reset();for(var o;e.next();)for(o=e.current(),t=new AtomEnumerator(i);t.next();)n=t.current(),n=$.trim(n),$(o).val()==n&&$(o).attr("checked","true")}}},onDataChange:function(){for(var t=new AtomEnumerator(this._dataElements),e=[];t.next();){var n=t.current(),i=$(n).val(),o=$(n).attr("checked");o&&e.push(i)}this._value=e.join(", "),AtomBinder.refreshValue(this,"value")},createChildElement:function(t,e,n){var i=document.createElement("SPAN");e.appendChild(i),e=i,i=document.createElement("SPAN");var o=this.get_labelPath(),r=this.get_valuePath();l=n,v=n,o&&(l=n[o]),r&&(v=n[r]);var s=null;this._isRadio&&(s="_g"+AtomUI.getNewIndex()),e.appendChild(i);for(var a=new AtomEnumerator(this._options);a.next();){var m=a.current();r&&(m=m[r]);var u=v+"."+m,h=document.createElement("INPUT");this._isRadio?($(h).attr("type","radio"),$(h).attr("name",s)):$(h).attr("type","checkbox"),$(h).val(u),i.appendChild(h),this.bindEvent(h,"change","onDataChange"),this._dataElements.push(h)}i=document.createElement("SPAN"),e.appendChild(i);var d=document.createTextNode(l);i.appendChild(d)}}})}(window,WebAtoms.AtomControl.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomNavigatorList",base:e,start:function(){this._displayMode=0,this._presenters=["gridPanel","gridPresenter","itemsPresenter","detailHeaderPresenter","newHeaderPresenter","detailPresenter","newPresenter","newView","detailView","newHeaderToolbar","detailHeaderToolbar"],this._layout=new WebAtoms.AtomViewBoxLayout,this._newItem={}},properties:{autoShowDetail:!0,currentPage:null,pageSize:void 0,newItem:null,newUrl:null,detailUrl:null,displayMode:null},methods:{get_newItemCopy:function(){return this._newItemCopy},onBackCommand:function(){AtomBinder.setValue(this,"displayMode",0),this.updateDisplayMode(),AtomBinder.setValue(this,"selectedIndex",-1)},onCancelAddNewCommand:function(){this.onBackCommand(),AtomBinder.refreshValue(this,"newItemCopy"),this.refresh()},onAddCommand:function(){AtomBinder.setValue(this,"selectedIndex",-1),AtomBinder.setValue(this,"displayMode",2);var t=this._newItem||{};this._newItemCopy=AtomBinder.getClone(t),AtomBinder.refreshValue(this,"newItemCopy"),this.updateDisplayMode()},onSelectedItemsChanged:function(){e.onSelectedItemsChanged.apply(this,arguments),this._autoShowDetail&&this.showDetailCommand()},addTemplate:function(t,e,n){n?(t.appendChild(e),e._templateParent=this,this.onCreateChildren(t),this.initChildren(t)):(t.appendChild(e),e._templateParent=this,this.onCreateChildren(t))},updateDisplayMode:function(){var t=this._displayMode;if(0==t)return this._detailPresenter&&(this._detailView.atomControl.dispose(this._detailPresenter),this._detailPresenter=null),this._newPresenter&&(this._newView.atomControl.dispose(this._newPresenter),this._newPresenter=null),this._detailHeaderPresenter&&(this._detailView.atomControl.dispose(this._detailHeaderPresenter),this._detailHeaderPresenter=null),void(this._newHeaderPresenter&&(this._newView.atomControl.dispose(this._newHeaderPresenter),this._newHeaderPresenter=null));var e,n=null,i=this.getTemplate("detailTemplate"),o=null,r="";1==t?(n=this._detailView,o=this._detailHeaderToolbar,e=this.getTemplate("detailHeaderTemplate"),r="_detail"):(n=this._newView,o=this._newHeaderToolbar,e=this.getTemplate("newHeaderTemplate"),r="_new"),o&&e&&(e=AtomUI.cloneNode(e),this.addTemplate(o,e,!0),this[r+"HeaderPresenter"]=e),n&&i&&(i=AtomUI.cloneNode(i),this.addTemplate(n,i,!0),this[r+"Presenter"]=i)},createChildren:function(){e.createChildren.call(this),this.getTemplate("gridTemplate"),this.getTemplate("detailTemplate"),this.getTemplate("searchTemplate"),this.getTemplate("detailHeaderTemplate"),this.getTemplate("newHeaderTemplate"),this.getTemplate("headerTemplate"),this.getTemplate("footerTemplate");var t=this.get_scope();this._newView.atomControl._scope=new AtomScope(this,t),this._detailView.atomControl._scope=new AtomScope(this,t);var n=AtomUI.cloneNode(this._gridTemplate);if(this.addTemplate(this._gridPresenter,n),$(this._detailTemplate).attr("atom-dock")||$(this._detailTemplate).attr("atom-dock","Fill"),this._headerTemplate){var i=AtomUI.cloneNode(this._headerTemplate);i.setAttribute("atom-dock","Top"),$(i).addClass("atom-navigator-list-header"),i._templateParent=this,this.addTemplate(this._gridPanel,i)}if(this._footerTemplate){var o=AtomUI.cloneNode(this._footerTemplate);o.setAttribute("atom-dock","Bottom"),$(i).addClass("atom-navigator-list-footer"),this.addTemplate(this._gridPanel,o)}},init:function(){e.init.call(this);var t=this;this.backCommand=function(){t.onBackCommand.apply(t,arguments)},this.addCommand=function(){t.onAddCommand.apply(t,arguments)},this.cancelAddCommand=function(){t.onCancelAddNewCommand.apply(t,arguments)},this.showDetailCommand=function(){var e=t.get_selectedItem();e&&(AtomBinder.setValue(t,"displayMode",1),t.updateDisplayMode())}}}})}(window,WebAtoms.AtomListBox.prototype),function(t,e){var n=t.AtomUI;return classCreatorEx({name:"WebAtoms.AtomNumberComboBox",base:e,start:function(){},properties:{showPrompt:!1,startNumber:void 0,endNumber:void 0,step:1},methods:{set_startNumber:function(t){this._startNumber=t,this.resetNumbers()},set_endNumber:function(t){this._endNumber=t,this.resetNumbers()},set_step:function(t){t&&(this._step=t,this.resetNumbers())},onLoaded:function(){this.resetNumbers()},resetNumbers:function(){if(this._created&&void 0!==this._startNumber&&void 0!==this._endNumber){var t=n.toNumber(this._startNumber),e=n.toNumber(this._endNumber),i=n.toNumber(this._step),o=[];for(this._showPrompt&&o.push({label:"Select",value:0});e>=t;t+=i)o.push({label:t,value:t});this.set_items(o)}}}})}(window,WebAtoms.AtomComboBox.prototype),function(window,base){var document=window.document,$=window.$;return classCreatorEx({name:"WebAtoms.AtomPhoneControl",base:base,start:function(){this._value=""},properties:{},methods:{set_value:function(t){this._value=t,this._countries&&this.setupValues()},setupValues:function(){if(!this._value)return $(this.num).val(""),$(this.ext).val(""),void $(this.msg).val("");for(var t=this._value.split(":",6),e=t[1],n=new AtomEnumerator(this._countries);n.next();){var i=n.current();if(i.country==e){this.cs.selectedIndex=n.currentIndex();break}}var o=(t[3]||"").split(".").join("-");"--"==o&&(o=""),$(this.num).val(o),$(this.ext).val(t[4]),$(this.msg).val(t[5]),this.onFormat()},onDataChange:function(){var t="v2:",e=this.cs.selectedIndex,n=this._countries[e];t+=n.country+":"+n.code;var i=$(this.num).val().split("-").join(".");t+=":"+i,t+=":"+$(this.ext).val(),t+=":"+$(this.msg).val(),this._value=i?t:"",AtomBinder.refreshValue(this,"value")},setCountries:function(r){this._countries=r;var options=this.cs.options;options.length=0;for(var ae=new AtomEnumerator(r);ae.next();){var ci=ae.current();if(!ci.valueIndex){ci.label=ci.label,ci.valueIndex=ae.currentIndex();var obj=eval("("+ci.value+")");ci.country=obj.country,ci.code=obj.code,ci.format=obj.format}options[ae.currentIndex()]=new Option(ci.label,ci.valueIndex,!1,!1)}this.setupValues(),this.onFormat()},onCountryChange:function(){this.onDataChange(),this.onFormat()},onFormat:function(){var t=this.cs;if(-1!=t.selectedIndex){var e=this._countries[t.selectedIndex];if(e.format&&e.format.length&&e.format.length>0){this._currentFormat=[];for(var n=0,i=new AtomEnumerator(e.format);i.next();)n+=i.current(),this._currentFormat.push(n)}}},onKeyUp:function(){if(this._currentFormat){var t=this.num.value;t=t.replace(/\D/g,"");for(var e="",n=0;n<t.length;n++)e+=t[n],n<t.length-1&&-1!=$.inArray(n+1,this._currentFormat)&&(e+="-");this.num.value=e}},init:function(){this.cs=document.createElement("SELECT"),this.num=document.createElement("INPUT"),this.num.type="text",this.ext=document.createElement("INPUT"),this.ext.type="text",$(this.ext).attr("placeholder","Ext."),this.msg=document.createElement("INPUT"),this.msg.type="text",$(this.msg).attr("placeholder","Message");var t=this.get_element();t.appendChild(this.cs),t.appendChild(this.num),t.appendChild(this.ext),t.appendChild(this.msg);var e=this;this.onKeyUpLater=function(t){var n=t;e.onKeyUp(n),e.onDataChange(n)},this.bindEvent(this.cs,"change","onCountryChange"),this.bindEvent(this.num,"change","onDataChange"),this.bindEvent(this.num,"keyup","onKeyUpLater"),this.bindEvent(this.num,"keypress","onKeyUpLater"),this.bindEvent(this.ext,"change","onDataChange"),this.bindEvent(this.msg,"change","onDataChange"),$(this._element).addClass("atom-phone-control"),$(this.num).addClass("atom-pc-num"),$(this.msg).addClass("atom-pc-msg"),$(this.cs).addClass("atom-pc-cs"),$(this.ext).addClass("atom-pc-ext");var n=this;AtomPromise.cachedJson("/config/phonecountries").then(function(t){n.setCountries(t.value())}).invoke(),base.init.call(this)}}})}(window,WebAtoms.AtomControl.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomRadioButtonList",base:e,start:function(){this._allowMultipleSelection=!1},properties:{},methods:{updateChildSelections:function(){for(var t=this.get_dataItems(),e=new AtomEnumerator(t),n=this._dataElements;e.next();){var i=e.current(),o=n[e.currentIndex()];this.isSelected(i)?$(o).attr("checked","true"):$(o).removeAttr("checked")}},onDataChange:function(t){this._onUIChanged=!0;var e=t.target,n=e;this.hasItems()&&(n=$(e).data("atom-data-item"));var i=$(e).attr("checked");AtomBinder.clear(this._selectedItems),this.isSelected(n)?i||AtomBinder.removeItem(this._selectedItems,n):i&&AtomBinder.addItem(this._selectedItems,n),this._onUIChanged=!1},createChildElement:function(t,e,n){var i=document.createElement("SPAN"),o=document.createElement("INPUT");$(o).attr("type","radio"),$(o).attr("name",this._groupName);var r=this.get_labelPath(),s=this.get_valuePath();l=n,v=n,r&&(l=n[r]),s&&(v=n[s]),$(o).data("atom-data",v),$(o).data("atom-data-item",n),$(o).val(l),i.appendChild(o);var a=document.createTextNode(l);return i.appendChild(a),e.appendChild(i),this.bindEvent(o,"change","onDataChange"),o},init:function(){this._groupName="__g"+AtomUI.getNewIndex(),e.init.call(this)}}})}(window,WebAtoms.AtomCheckBoxList.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomSortableColumn",base:e,start:function(){},properties:{direction:"",defaultDirection:"",label:"",sortField:null},methods:{set_direction:function(t){this._direction=t,$(this._element).removeClass("atom-sort-asc"),$(this._element).removeClass("atom-sort-desc"),t&&$(this._element).addClass("atom-sort-"+t.toLowerCase())},set_value:function(t){this._value=t,this.refreshUI()},refreshUI:function(){return this._value?-1==this._value.indexOf(this._sortField)?void AtomBinder.setValue(this,"direction",""):void(this._value.lastIndexOf("desc")!=this._value.length-4?AtomBinder.setValue(this,"direction","asc"):AtomBinder.setValue(this,"direction","desc")):void 0},onClick:function(){this._direction?"asc"==this._direction?AtomBinder.setValue(this,"direction","desc"):AtomBinder.setValue(this,"direction","asc"):AtomBinder.setValue(this,"direction",this._defaultDirection),AtomBinder.setValue(this,"value",this._sortField+" "+this._direction)},init:function(){e.init.call(this),this.bindEvent(this._element,"click","onClick"),$(this._element).addClass("atom-column")},onUpdateUI:function(){this.refreshUI()}}})}(window,WebAtoms.AtomControl.prototype),function(t){return classCreatorEx({name:"WebAtoms.AtomTabButtonBar",base:t,start:function(){this._allowMultipleSelection=!1,this._showTabs=!0},methods:{}})}(WebAtoms.AtomLinkBar.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomTabControl",base:e,start:function(){this._presenters=["itemsPresenter"],this._layout=WebAtoms.AtomViewBoxLayout.defaultInstance,this.selectedIndex=0,this.labelPath="label"},properties:{items:null},methods:{createChildren:function(){if(e.createChildren.call(this),this._itemsPresenter!=this._element){for(var t=[],n=new ChildEnumerator(this._element);n.next();){var i=n.current();this._element.removeChild(i),t.push(i)}if(this._template){var o=AtomUI.cloneNode(this._template);o._templateParent=this,this._element.appendChild(o),this.onCreateChildren(this._element)}for(n=new AtomEnumerator(t);n.next();)this._itemsPresenter.appendChild(n.current());
this._template&&this.onCreateChildren(this._itemsPresenter)}}}})}(window,WebAtoms.AtomControl.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomTimePicker",base:e,properties:{displayLabel:"9:00 AM"},methods:{init:function(){this._autoOpen=!0;for(var t=[],n=0;23>=n;n++){var i="AM",o=n;n>11&&(i="PM",n>12&&(o=n-12));var r=o+":00 "+i;t.push({label:r,value:r}),r=o+":30 "+i,t.push({label:r,value:r})}this._items=t,e.init.call(this)}}})}(window,WebAtoms.AtomAutoCompleteBox.prototype),function(t){return classCreatorEx({name:"WebAtoms.AtomUploadButton",base:t,start:function(t){return/input/gi.test(t.nodeName)&&/file/gi.test($(t).attr("type"))?void(this._filePresenter=t):(this._filePresenter=document.createElement("input"),$(this._filePresenter).attr("type","file"),$(this._filePresenter).css("left","-500px"),$(this._filePresenter).css("position","absolute"),$(this._filePresenter).css("top","-0px"),void document.body.appendChild(this._filePresenter))},properties:{fileTypes:void 0,accept:"*/*",capture:"",progress:0},methods:{set_accept:function(t){this._accept=t,t&&this._filePresenter&&$(this._filePresenter).attr("accept",t)},set_capture:function(t){this._capture=t,t&&this._filePresenter&&$(this._filePresenter).attr("capture",t)},onClickHandler:function(t){(!this._confirm||confirm(this._confirmMessage))&&this._postUrl&&this._filePresenter!=this._element&&($(this._filePresenter).trigger("click"),AtomUI.cancelEvent(t))},onFileSelected:function(){var t=this.get_postData();if(null!==t&&void 0!==t){var e=this._mergeData;if(e)for(var n in e)t[n]=e[n];var i=this._xhr;if(!i){i=new XMLHttpRequest;var o=i.upload;try{i.timeout=36e5}catch(r){}this.bindEvent(o,"progress","onProgress"),this.bindEvent(o,"timeout","onError"),this.bindEvent(o,"error","onError"),this.bindEvent(i,"load","onComplete"),this.bindEvent(i,"error","onError"),this.bindEvent(i,"timeout","onError"),this._xhr=i}for(var s=new FormData,a=new AtomEnumerator(this._filePresenter.files);a.next();)s.append("file"+a.currentIndex(),a.current());s.append("formModel",JSON.stringify(AtomBinder.getClone(t))),i.open("POST",this._postUrl),i.send(s),atomApplication.setBusy(!0,"Uploading...")}},set_progress:function(t){this._progress=t,t&&AtomBinder.setValue(atomApplication,"progress",t)},onError:function(t){atomApplication.setBusy(!1,"Uploading..."),this.unbindEvent(this._xhr),this._xhr=null,this._lastError=t,Atom.alert("Upload failed")},onProgress:function(t){if(t.lengthComputable){var e=Math.round(100*t.loaded/t.total);AtomBinder.setValue(this,"progress",e)}},onComplete:function(t){atomApplication.setBusy(!1,"Uploading...");if(t.target){if(200!=t.target.status)return void Atom.alert(t.target.statusText);this._value=t.target.responseText}else this._value=t.result;this.unbindEvent(this._xhr),this._xhr=null,AtomBinder.refreshValue(this,"value"),this.invokeAction(this._next,t)},init:function(){t.init.call(this);var e=this._filePresenter;this.bindEvent(e,"change","onFileSelected")}}})}(WebAtoms.AtomPostButton.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomViewBox",base:e,start:function(){this._layout=t.AtomViewBoxLayout.defaultInstance},methods:{}})}(WebAtoms,WebAtoms.AtomControl.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomWizard",base:e,start:function(){this._presenters=["viewPresenter"]},properties:{currentStep:null,nextLabel:"Next",nextClass:"",buttons:null,prevLabel:"Back",finishLabel:"Finish",canMoveBack:!0,canMoveNext:!0,steps:0,isLastStep:!1},methods:{set_currentStep:function(t){this._currentStep=t;var e=this._buttons;if(e&&e.length){var n=e[t];AtomBinder.setValue(this,"nextLabel",n.label),AtomBinder.setValue(this,"nextClass",n.styleClass)}AtomBinder.refreshValue(this,"isLastStep")},get_isLastStep:function(){return this._currentStep==this._steps-1},init:function(){$(this._element).addClass("atom-wizard"),e.init.call(this);var t=this;this.goNextCommand=function(e,n,i){t.get_isLastStep()?(t.invokeAction(t._next,i),AtomBinder.setValue(t,"canMoveBack",!1)):AtomBinder.setValue(t,"currentStep",t._currentStep+1)},this.goPrevCommand=function(){AtomBinder.setValue(t,"currentStep",t._currentStep-1)},this.resetCommand=function(){AtomBinder.setValue(t,"currentStep",0),AtomBinder.setValue(t,"canMoveBack",!0)};for(var n=this._viewPresenter,i=this._viewTemplate,o=0,r=new ChildEnumerator(i);r.next();){o++;var s=r.current();n.appendChild(s);var a=$(s).attr("atom-type");a||(a="AtomViewBox",$(s).attr("atom-type",a));var l=$(s).attr("atom-type")||WebAtoms.AtomControl,m=AtomUI.createControl(s,l);m.init()}AtomBinder.setValue(this,"steps",o),o&&AtomBinder.setValue(this,"currentStep",0),this.nextCommand=function(e,i,o){var r=n.atomControl.get_selectedChild().atomControl;return r._next?void r.invokeAction(r._next):void t.goNextCommand(e,i,o)}}}})}(window,WebAtoms.AtomDockPanel.prototype),function(t){return classCreatorEx({name:"WebAtoms.AtomYesNoControl",base:t,start:function(){this._allowSelectFirst=!1,this._items=[{label:"Yes",value:!0},{label:"No",value:!1}]},methods:{init:function(){this._element.style.height="26px",t.init.call(this)}}})}(WebAtoms.AtomToggleButtonBar.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomYesNoCustom",base:e,start:function(){this._presenters=["yesNo","input"],this._hasValue=!1},properties:{hasValue:!1,placeholder:null},methods:{set_hasValue:function(t){this._hasValue=t,t||AtomBinder.setValue(this,"value","")},set_value:function(t){this._value=t,AtomBinder.setValue(this,"hasValue",t?!0:!1),this._onUIChanged||$(this._input).val(t)},onValueChange:function(){this._onUIChanged=!0;var t=$(this._input).val();AtomBinder.setValue(this,"value",t),this._onUIChanged=!1},onUpdateUI:function(){$(this._input).addClass("atom-yes-no-custom-input"),this._placeholder&&($(this._input).attr(this._placeholder),placeHolderFixer.refresh())},init:function(){e.init.call(this),this._yesNo=this._yesNo.atomControl;var t=this._input;this.bindEvent(t,"change","onValueChange")}}})}(window,WebAtoms.AtomControl.prototype),function(t,e,n){return classCreatorEx({name:"WebAtoms.AtomSkinnedApplication",base:n,start:function(){this._presenters=["appPresenter"]},methods:{setup:function(){var t=this._element,e=$(t).attr("atom-skin");if(!e)throw new Error("Skin is missing");this._skinTemplate=t.innerHTML,t.innerHTML="";var n=this,i=AtomPromise.get(e).then(function(){n.skinLoaded(i)});i.invoke()},skinLoaded:function(t){this._element.innerHTML=t.value(),n.setup.call(this)},createChildren:function(){var t=this._skinTemplate;this._appPresenter=$(this._element).find("[atom-presenter=appPresenter]").first()[0];var e=this._element.innerHTML;e=e.replace(this._appPresenter.innerHTML,t),this._element.innerHTML=e,base.createChildren.call(this)}}})}(window,"WebAtoms.AtomSkinnedApplication",WebAtoms.AtomApplication.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomAutoPostForm",base:e,start:function(){},properties:{isBusy:!1,postError:null},methods:{pushPost:function(t){if(!this._isBusy){this._pushPostTimeout&&clearTimeout(this._pushPostTimeout),t||(t=1e3);var e=this;this._pushPostTimeout=setTimeout(function(){WebAtoms.dispatcher.callLater(function(){e.onSubmit()})},t)}},onSubmit:function(){if(this._pushPostTimeout=0,!this._isBusy&&this.isValid()){var t=this.preparePostData();if(t){var e=JSON.stringify(AtomBinder.getClone(t));if(!this._cachedData||e!=this._cachedData){this._cachedData=e;var n=this,i=AtomPromise.getUrl(this._postUrl),o=AtomPromise.json(i,null,{type:"POST",data:t}).then(n._success);o.failed(function(){n._isBusy=!1,n._postError=o.error.msg,AtomBinder.refreshValue(n,"isBusy"),AtomBinder.refreshValue(n,"postError")}),o.showProgress(!1),o.showError(!1),o.invoke()}}}},onCreated:function(){e.onCreated.apply(this,arguments);var t=this.preparePostData();t&&(this._cachedData=JSON.stringify(AtomBinder.getClone(t)))},onSuccess:function(){e.onSuccess.apply(this,arguments),this._isBusy=!1,AtomBinder.refreshValue(this,"isBusy")},onKeyUp:function(t){this.pushPost(),t.target&&t.target.nodeName&&/textarea/gi.test(t.target.nodeName)||13==t.keyCode&&this.onSubmit()},init:function(){e.init.call(this);var t=this;this.pushPostHandler=function(){t.pushPost(1e3)},this.bindEvent(this._element,"click",this.pushPostHandler),$(this._element).find("input,select,textarea").bind("change",null,this.pushPostHandler)}}})}(window,WebAtoms.AtomForm.prototype),function(window,baseType){return classCreatorEx({name:"WebAtoms.AtomFormField",base:baseType,start:function(){this._presenters=["contentPresenter"]},properties:{error:void 0,dataType:null,label:void 0,fieldClass:void 0,required:!1,isValid:void 0,regex:null,fieldValue:void 0,field:null,requiredMessage:"Required",invalidMessage:"Invalid",fieldVisible:!0,validate:!1,isValidSet:!1},methods:{set_dataType:function(t){this._dataType=t,this.setup()},set_fieldValue:function(t){this._fieldValue=t,this._validate&&this.validate()},set_isValid:function(t){this._isValid=t,this._isValidSet=!0,this._validate&&this.validate()},set_regex:function(t){this._regex=t,this.setup()},set_required:function(t){this._required=t,this.setup()},validateChildren:function(t){for(var e=new ChildEnumerator(t);e.next();){var n=e.current();n.atomControl?this.validateValue(AtomBinder.getValue(n.atomControl,"value")):/input|select|textarea/gi.test(n.nodeName)?this.validateValue($(n).val()):this.validateChildren(n)}},validateValue:function(v){if(this._required){if(!v)return AtomBinder.setValue(this,"error",this._requiredMessage),void(this._isValid=!1)}else if(!v)return void(this._isValid=!0);var re=null;return/email/gi.test(this._dataType)?re=/^(([^<>()\[\]\\.,;:\s@\"]+(\.[^<>()\[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/:this._regex&&(re=eval("("+this._regex+")")),re&&!re.test(v)?(AtomBinder.setValue(this,"error",this._invalidMessage),void(this._isValid=!1)):void 0},validate:function(){return this._validate=!0,this._required||this._regex||this._dataType?this._isValid&&(AtomBinder.setValue(this,"error",""),this._isValidSet)?!0:(this._isValid=!0,void 0!==this._fieldValue?this.validateValue(this._fieldValue):this.validateChildren(this._element),this._isValid&&AtomBinder.setValue(this,"error",""),this._isValid):void 0===this._isValid?!0:this._isValid},onCreated:function(){this.setup()},onFocusOut:function(){this._validate=!0,this.validate()},setup:function(){if(this._created){var t=this._element;this._contentPresenter&&this._contentPresenter.appendChild(this._element.contentElement);for(var e=new AtomEnumerator($(t).find("input,select,textarea"));e.next();){var n=e.current();this.bindEvent(n,"blur","onFocusOut"),this.bindEvent(n,"change","onFocusOut")}AtomBinder.refreshValue(this,"fieldClass")}}}})}(window,WebAtoms.AtomControl.prototype),function(t,e){return classCreatorEx({name:"WebAtoms.AtomFormGridLayout",base:e,start:function(){},properties:{minLabelWidth:100,cellSpacing:5,label:""},methods:{onUpdateUI:function(){AtomBinder.refreshValue(this,"controlWidth"),AtomBinder.refreshValue(this,"controlHeight"),e.onUpdateUI.apply(this,arguments)},get_controlWidth:function(){return $(this._element.parentNode).innerWidth()},get_controlHeight:function(){return $(this._element.parentNode).innerHeight()},createChildren:function(){var t=this._element;$(t).addClass("atom-form-grid");var e=$(t).children(),n=new AtomEnumerator(e);AtomUI.removeAllChildren(t);var i=document.createElement("DIV");$(i).addClass("atom-form-grid-container"),t.appendChild(i);$(this._element).attr("atom-min-label-width");for(this.getTemplate("fieldTemplate");n.next();){var o=n.current(),r=AtomUI.attributeMap(o,/^(atom\-type)$/gi)["atom-type"];if(r&&"AtomFormRow"==r.value){var s=document.createElement("TABLE");i.appendChild(s),$(s).addClass("atom-form-grid-row");var a=document.createElement("TBODY");s.appendChild(a);var l=document.createElement("TR");a.appendChild(l);for(var e=$(o).children(),m=new AtomEnumerator(e);m.next();){var u=document.createElement("TD");l.appendChild(u),this.createField(u,m.current())}}else if(!r||"AtomFormTabControl"!=r.value&&"AtomTabControl"!=r.value)this.createField(i,o);else{var h=document.createElement("DIV");h.setAttribute("atom-type","AtomToggleButtonBar");var d=AtomUI.assignID(h);h.setAttribute("atom-name",d),h.setAttribute("atom-show-tabs","true");var c=document.createElement("SPAN");h.appendChild(c),c.setAttribute("atom-text","{$data.label}"),c.setAttribute("atom-template","itemTemplate"),this.createField(i,h);for(var p=allControls[d],m=new ChildEnumerator(o),f=[],v=0;m.next();){var _=m.current();$(_).remove(),_.setAttribute("style-display","[$scope."+d+".selectedIndex == "+v+" ? '' : 'none']");var g=this.createField(i,_);f.push(g),v++}p.set_items(f)}}}}})}(window,WebAtoms.AtomFormLayout.prototype),function(t){return classCreatorEx({name:"WebAtoms.AtomFormTab",base:t,start:function(){},methods:{}})}(WebAtoms.AtomFormGridLayout.prototype),function(t){return classCreatorEx({name:"WebAtoms.AtomFormNoLayout",base:t,start:function(){},methods:{}})}(WebAtoms.AtomForm.prototype),function(t){return classCreatorEx({name:"WebAtoms.AtomFormVerticalLayout",base:t,start:function(){},methods:{}})}(WebAtoms.AtomFormLayout.prototype),function(t){return classCreatorEx({name:"WebAtoms.AtomTableLayout",base:t,start:function(t,e,n){this._cellWidth=e,this._cellHeight=n,this._columns=t},methods:{doLayout:function(t){var e,n=new AtomEnumerator($(t).children()),i=0,o=0,r=Math.ceil(n._array.length/this._columns)-1,s=r,a=this._columns*this._cellWidth,l=this._cellHeight*(r+1);for(t.style.position="relative",t.style.width=a+"px",t.style.height=l+"px",t.maxRows=r;n.next();)e=n.current(),e.style.position="absolute",e.style.left=i+"px",e.style.top=o+"px",e.style.width=this._cellWidth+"px",0>=s?(s=r,i+=this._cellWidth+10,o=0):(s--,o+=this._cellHeight)}}})}(WebAtoms.AtomLayout.prototype);var AtomViewBoxLayout=function(t){return classCreatorEx({name:"WebAtoms.AtomViewBoxLayout",base:t,start:function(){},methods:{doLayout:function(t){for(var e,n={width:$(t).innerWidth()+"px",height:$(t).innerHeight()+"px"},i=new ChildEnumerator(t);i.next();)e=i.current(),e.style.width=n.width,e.style.height=n.height,e.atomControl&&e.atomControl.updateUI()}}})}(WebAtoms.AtomLayout.prototype);AtomViewBoxLayout.defaultInstance=new AtomViewBoxLayout,Atom.confirm=function(t,e){var n={Message:t,ConfirmValue:!1,Confirm:e?!0:!1},i=document.createElement("DIV");document.body.appendChild(i);var o=AtomUI.createControl(i,WebAtoms.AtomWindow,n);o.set_windowWidth(380),o.set_windowHeight(120),o.set_windowTemplate(o.getTemplate("alertTemplate")),o.set_title(e?"Message":"Confirm"),o.set_next(function(){o.dispose(),$(i).remove(),n.ConfirmValue&&e&&e()}),o.refresh()},Atom.alert=window.__chromeCSP?function(t){Atom.confirm(t,null)}:function(t){alert(t)},$(window.document).ready(function(){WebAtoms.dispatcher.setupControls(),WebAtoms.dispatcher.start()})}(window,WebAtoms);
//# sourceMappingURL=atoms.min.map